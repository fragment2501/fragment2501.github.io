---
layout: post
title: Copying AD Users into a SharePoint 2010 SPGroup
date: '2014-10-17T12:39:00.002-07:00'
author: Bryan Rudden
tags: 
modified_time: '2014-10-17T13:20:16.012-07:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-3650120616481193653
blogger_orig_url: http://www.bryansgeekspeak.com/2014/10/copying-ad-users-into-sharepoint-2010.html
---

<div class="sidenote">NOTE - if you are using Active Directory and you have user profiles being synced from AD to SharePoint, you should be able to apply security directly to an AD group and have it work recursively (with limitations - <a href="http://technet.microsoft.com/en-us/library/cc261972.aspx">http://technet.microsoft.com/en-us/library/cc261972.aspx</a>). With a custom claims provider in one of the applications I'm working on I can't get the provider to recursively read group membership, I'm told it's a limitation of the provider. With all that said, the notes here discuss a workaround for my claims provider issue.</div> <p>I've run into a problem with SharePoint 2010 configured for Claims auth where the claims provider wont recursively read group membership. So if you have a claims group configured with a child group that contains users, like this:</p><div class="code"><ul><li>my_master_group <ul><li>User1</li><li>my_child_group <ul><li>User2</li></ul></li><ul></ul></ul></li></ul></div><p>And then try to assign my_master_group rights to a SharePoint site, only User1 picks up those rights. User2 is ignored. So only top level group members are ever granted rights.  In my case, my source claims repository has complex nested group structure that is synced up with our orgs Active Directory.  I have one master group that recursively holds all my group members and now I just want to get them into a SPGroup that I can then use for granting rights to my site.  Here is my first stab at a rough solution for this, until the provider issue is resolved.</p><h2>Create a scheduled task to copy AD members into a SPGroup</h2><p>The plan is to first query AD, get a recursive list of my_master_group members and add them to the SharePoint group sp_my_master_group.</p> <h3>Get a list of AD Principal Objects</h3><script src="https://gist.github.com/fragment2501/2cc0d9e5d9bfe3aaec4a.js"></script> <h3>Insert Principals into a SharePoint Group</h3><script src="https://gist.github.com/fragment2501/c0405f95ad9e8f9db205.js"></script>