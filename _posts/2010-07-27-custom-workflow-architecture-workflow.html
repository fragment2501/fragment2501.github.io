---
title: 'Custom Workflow Architecture: Workflow Steps and Transitions'
date: '2010-07-27T09:28:00.000-07:00'
tags:
- Workflow
modified_time: '2010-07-27T12:57:53.835-07:00'
thumbnail: http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s72-c/Workflow_Step_Trans_Tables2.JPG
blogger_id: tag:blogger.com,1999:blog-19111454.post-7473246707321903457
blogger_orig_url: http://www.bryansgeekspeak.com/2010/07/custom-workflow-architecture-workflow.html
---

<b>!!ROUGH DRAFT!!</b><br /><br /><div class="sidenote">This post expands on a previous post: <a href="http://www.bryansgeekspeak.com/2010/07/custom-workflow-architecturte-routing.html">Custom Workflow Architecture: The Routing Table</a></div><br />In my previous post we looked at a simple one step approval workflow and talked about how to store workflow activity to a routing table.  In this post we'll look at one possible way to define a workflow's steps and transitions in a set of database tables, and how a workflow engine might utilize that information for use in a web application.<br /><br />In designing our new system, we'll continue using the simple one step approval workflow at first, but I know that we will want to support more than just that one workflow in our new system.  So first I'll define a table in the database to identify unique workflows available in our web application:<br /><br /><div class="code">--- Create table Workflow<br />CREATE TABLE Workflow (<br />ID INT NOT NULL,<br />Name VARCHAR2(128) NULL,<br />Description VARCHAR2(2000) NULL<br />);<br />--- Set column ID to be Primary Key for table Workflow<br />ALTER TABLE Workflow ADD CONSTRAINT Workflow_PK1 PRIMARY KEY (ID);</div><br />Keeping things simple, this table tags each available workflow with a unique id (Workflow.ID).  In addition to the unique id, we can also assign a human readable name and description to help us identify the workflow.  Lets insert a new record that will define the one step workflow we defined in the previous post (we will recreate that workflow from scratch in this example):<br /><br /><div class="code">INSERT INTO Workflow (<br />ID,<br />Name,<br />Description<br />)VALUES(<br />1,<br />'Vacation Request Workflow',<br />'A workflow to allow employees to request vacation time.'<br />);<br />COMMIT;</div><br />Now that we have a workflow record in the system, we can go about creating a list of workflow steps (sometimes called Workflow States) we want to display in our application.  We'll create a new table to hold our steps and link them back to the workflow they belong to.<br /><br /><div class="code">--- Create table WorkflowStep<br />CREATE TABLE WorkflowStep (<br />ID INT NOT NULL,<br />WorkflowID INT NOT NULL,<br />Name VARCHAR2(128) NULL,<br />Description VARCHAR2(2000) NULL<br />);<br />--- Set column ID to be Primary Key for table WorkflowStep<br />ALTER TABLE WorkflowStep ADD CONSTRAINT WorkflowStep_PK1 PRIMARY KEY (ID);<br />--- Set foreign key pointing back to the Workflow table<br />ALTER TABLE WorkflowStep ADD CONSTRAINT WorkflowStep_FK1 FOREIGN KEY (WorkflowID) REFERENCES Workflow(ID);</div><br />Now that we have a table to hold the steps, we need to define what steps exist in our workflow. Even though we are calling this a one step approval workflow, there are really at least 2 steps involved - When the employee is working on his request, thats the first step of the workflow.  Then, when the manager works on the request, after it's been submitted for approval by the Employee, thats the second step. <br /><br />In addition, I'm going to add two extra steps - a step to represent the start of the workflow and another to represent the end (as shown in the flowchart diagram).  Start and end point steps are not steps that users get to see, or act on, but it allows our application to see workflow instances from start to finish. <br /><br />So lets go ahead and define all 4 of those steps in our new table with a few insert statements:<br /><br /><div class="code">INSERT INTO WorkflowStep (<br />ID,<br />WorkflowID,<br />Name,<br />Description<br />)VALUES(<br />1,<br />1,<br />'Workflow Instance Instantiated',<br />'This step marks the point where a workflow instance was created.'<br />);<br /><br />INSERT INTO WorkflowStep (<br />ID,<br />WorkflowID,<br />Name,<br />Description<br />)VALUES(<br />2,<br />1,<br />'Request Creation/Submission',<br />'A vacation request is created and submitted for approval at this step.'<br />);<br /><br />INSERT INTO WorkflowStep (<br />ID,<br />WorkflowID,<br />Name,<br />Description<br />)VALUES(<br />3,<br />1,<br />'Manager Review/Approval',<br />'The vacation request is reviewed and approved/rejected by a manager at this step.'<br />);<br /><br />INSERT INTO WorkflowStep (<br />ID,<br />WorkflowID,<br />Name,<br />Description<br />)VALUES(<br />4,<br />1,<br />'Workflow Completed',<br />'The vacation request was finalized (Either approved or rejected).'<br />);<br /><br />COMMIT;</div><br />Notice I havent defined any way to order these steps yet &gt;_&gt; We'll do that now using Transitions!<br /><br />If we look at the example workflow flowchart, we can see that steps are represented as squares.  The transitions are the lines with arrows that connect steps in the workflow.  Transitions define how you could get from one step to another.<br /><br />In our example workflow the transitions are pretty simple.  We've got at least 3 transitions to get us started:<br /><ol><li>A Transition from "Instantiate Workflow Instance" to "Request Creation/Submission", which happens when a user creates a new Vacation request. We'll call this transition "Instantiate Workflow"</li><li>A Transition from "Request Creation/Submission" to "Manager Review/Approval", which fires off when the employee submits his vacation request for review by a manager. We'll call this transition "Submit For Manager Approval"</li><li>A final Transition from "Manager Review/Approval" to "Workflow Completed". We'll call this "Approved by Manager"</li></ol><br />Lets slap together a table to store information about all the available transitions in the system:<br /><br /><div class="code">--- Create table WorkflowTrans<br />CREATE TABLE WorkflowTrans (<br />ID INT NOT NULL,<br />WorkflowID INT NOT NULL,<br />FromStepID INT NOT NULL,<br />ToStepID INT NOT NULL,<br />Name VARCHAR2(128) NULL,<br />Description VARCHAR2(2000) NULL<br />);<br />--- Set column ID to be Primary Key for table WorkflowTrans <br />ALTER TABLE WorkflowTrans ADD CONSTRAINT WorkflowTrans_PK1 PRIMARY KEY (ID);<br />--- Set foreign key pointing back to the Workflow table<br />ALTER TABLE WorkflowTrans ADD CONSTRAINT WorkflowTrans_FK1 FOREIGN KEY (WorkflowID) REFERENCES Workflow(ID);<br />--- Set foreign key pointing back to the starting WorkflowStep record for this trans<br />ALTER TABLE WorkflowTrans ADD CONSTRAINT WorkflowTrans_FK2 FOREIGN KEY (FromStepID) REFERENCES WorkflowStep(ID);<br />--- Set foreign key pointing back to the ending WorkflowStep record for this trans<br />ALTER TABLE WorkflowTrans ADD CONSTRAINT WorkflowTrans_FK3 FOREIGN KEY (ToStepID) REFERENCES WorkflowStep(ID);</div><br />Since a transition links one step to another, we need to link our transition to both the staring step and ending step.  Working with this table relationship, we can setup transitions to every possible step and back if we wanted to...for now, we'll stick to the 3 transitions we've already defined above. Here are the insert statements for them:<br /><br /><div class="code">INSERT INTO WorkflowTrans (<br />ID,<br />WorkflowID,<br />FromStepID,<br />ToStepID,<br />Name,<br />Description<br />)VALUES(<br />1,<br />1,<br />1,<br />2,<br />'Instantiate Workflow',<br />'The initial transition that fires off for every new workflow.'<br />);<br /><br />INSERT INTO WorkflowTrans (<br />ID,<br />WorkflowID,<br />FromStepID,<br />ToStepID,<br />Name,<br />Description<br />)VALUES(<br />2,<br />1,<br />2,<br />3,<br />'Submit For Manager Approval',<br />'Submit the request for approval.'<br />);<br /><br />INSERT INTO WorkflowTrans (<br />ID,<br />WorkflowID,<br />FromStepID,<br />ToStepID,<br />Name,<br />Description<br />)VALUES(<br />3,<br />1,<br />3,<br />4,<br />'Approved by Manager',<br />'Approve Request.'<br />);<br /><br />COMMIT;</div><br />That's enough to get us started. With all the above SQL run, you should have a table layout that looks something like this in your DB:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s1600/Workflow_Step_Trans_Tables2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="162" src="http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s400/Workflow_Step_Trans_Tables2.JPG" width="400" /></a></div><br />In the next article in the series, <a href="http://www.bryansgeekspeak.com/2010/07/custom-workflow-architecture-examining.html">Custom Workflow Architecture: Examining Workflow Data</a> , I'll take a closer look at the workflow we've defined here to see how we might generate some meaningful SQL queries to generate lists of steps and transitions that will be the basis of our workflow application.