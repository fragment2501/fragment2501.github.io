---
title: Windows 2008R2 MSDTC Errors
date: '2011-02-14T13:42:00.000-08:00'
author: Bryan
tags:
- MSDTC
- Windows 2008R2
- K2
modified_time: '2011-02-21T11:25:20.459-08:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-8697146493718927716
blogger_orig_url: http://www.bryansgeekspeak.com/2011/02/windows-2008r2-msdtc-errors.html
---

So, having moved away from using <a href="http://www-01.ibm.com/software/integration/lombardi-edition/" title="Lombardi Teamworks java BPM solution got gobbled up by IBM ... noooo!" alt="Lombardi Teamworks java BPM solution got gobbled up by IBM ... noooo!">IBM/Lombardi Teamworks</a> as a 3rd party workflow platform, our client decided to go with <a href="http://www.k2.com/en/blackpearl.aspx" title="The Microsoft friendly BPM solution?" alt="The Microsoft friendly BPM solution?">K2 blackpearl</a>, mostly because of the close Microsoft .NET/SharePoint integration.  As with any new 3rd party software toolkit, we ran into a number of strange deployment issues.  Here is one of the big ones that had us stumped for a few weeks - MSDTC generating errors when creating a K2 "SmartObject" instance on the K2 server in a distributed farm environment (all Windows 2008R2 servers).<br /><br /><div class="sidenote">The MSDTC transaction manager was unable to pull the transaction from the source transaction manager due to communication problems. Possible causes are: a firewall is present and it doesn't have an exception for the MSDTC process, the two machines cannot find each other by their NetBIOS names, or the support for network transactions is not enabled for one of the two transaction managers.<br /></div><br />As it turns out, K2 SmartObjects rely on the MSDTC service to do their data abstraction magic. I had no idea.  As a matter of fact, I had never even heard of MSDTC until this error cropped up.  It seems MSDTC is actually the Distributed Transaction Coordinator (which shows up in the services applet in windows 2008R2), which I understand to be a SQL server specific service for performing reliable "application transactions" across multiple windows servers to a SQL server instance.<br /><br />Anyway, we tried changing DTC security settings on all the servers first (Component Services-Computers-My Computer-Distributed Transaction Coordinator-Local DTC-Properties-Security tab) but no luck there. After a lot of trial and error, the support guys at K2 had me completely uninstall the MSDTC service, remove all its registry entries (eek!), reboot, then add all the services back in ... and after doing that on all the servers in my farm, it solved the problem.<br /><br />Why did this work? Well, one thing that leaps to mind is the error we were seeing using the <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=5e325025-4dcd-4658-a549-1d549ac17644" title="A good starting point for troubleshooting MSDTC issues!" alt="A good starting point for troubleshooting MSDTC issues!" >DTCPing</a> tool from microsoft:<br /><br /><div class="sidenote">WARNING:the CID values for both test machines are the same while this problem won't stop DTCping test, MSDTC will fail for this<br /></div><br />The recommended approach to fix this is to uninstall the MSDTC service on one of the servers involved in the DTCPing test.  Then I realized the MSDTC service is installed by default in Windows Server 2008R2 ... and all of our servers are VMWare instances cloned from a single Windows Server 2008R2 image. So my best guess is if you are using cloned VM images of Windows Server 2008R2, you could also run into this problem.<br /><br />Anyway, to "reinstall" MSDTC, I went though the following process which worked on my farm (though, this may be overkill):<br /><br /><div class="sidenote">On each server, do the following:<br /><ol><li>From Server Manager, Click "Roles", scroll down to the "Application Server" section, click "Remove Role Services" and uncheck/remove "Distributed Transactions"</li><li>From powershell in "Run as administrator" mode, issue the MSDTC uninstall command "msdtc -uninstall" (http://msdn.microsoft.com/en-us/library/aa561924%28v=bts.70%29.aspx) </li><li>Using regedt32.exe, delete all the MSDTC registry entries (My Computer\HKEY_LOCAL_MACHINE\Software\Microsoft\MSDTC) </li><li>Restart the server.</li><li>Reinstall the "Distributed Transactions" role service from step #1. In addition, I also made sure to install the MSMQ role/feature, and I enabled TCP Port sharing, all the "Windows Process Activation Service Support" features (I dont know if all of that is necessary)</li><li>Run the MSDTC install command from a powershell window as administrator "msdtc -install"</li><li>Reset all the DTS security settings (Component Services-Computers-My Computer-Distributed Transaction Coordinator-Local DTC-Properties-Security tab), and also update the "Distributed Transaction Coordinator" service to start automatically on boot</li><li>Reboot</li></ol></div>