---
title: Web Application Deployment - Deploying Database Changes
date: '2011-06-08T12:53:00.000-07:00'
tags:
- Oracle
- Databases
modified_time: '2011-06-08T17:37:03.144-07:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-4287940938776772059
blogger_orig_url: http://www.bryansgeekspeak.com/2011/06/web-application-deployment-deploying.html
---

<div class="sidenote">this article is another work in progress.  Comments and feedback are always welcome.<br /></div><br />This question keeps coming up at work over and over again.  So here we go - deploying database changes 101. Buckle down and do the upfront work, look sexy and awesome when it comes time for deployment >_><br /><br /><b>Synopsis</b><br />Here it is, this whole post summed up into one key idea:<br /><br /><div class="sidenote">Always create SQL scripts (insert/update/alter commands) to implement any and all database changes! Add those SQL scripts to your deployment package!</div><br />Curious as to what that means? Not sure if you know how to create SQL scripts for deployment? Looking for some tips and tricks on how to do a better job of that? OK! Lets dive in!<br /><br /><b>Example SQL Script for INITIAL Deployment of a Web Application</b><br /><br />Here is an example of a single table "Categories" and its data.  Keep in mind that this script is designed to be used only for the initial web application deployment.<br /><br /><div class="sidenote">NOTE: I'm following the <a href="http://www.bryansgeekspeak.com/2009/08/bryans-oracle-db-design-style-standard.html">Oracle DB Design Style Guide</a> I wrote up a while back as a guide for my SQL scripts here.<br /></div><br /><div class="code">--- Create the Category table<br />CREATE TABLE Category (<br />Id    INT NOT NULL,<br />Name  VARCHAR2(200) NULL,<br />Description  VARCHAR2(4000) NULL<br />);<br /><br />--- Primary Key Constraint<br />CREATE INDEX CategoryIdIdx ON Category(Id);<br />ALTER TABLE Category ADD CONSTRAINT CategoryIdPk PRIMARY KEY (Id);<br /><br />COMMENT ON TABLE Category IS 'A list of Categories for use in a TODO list.';<br />COMMENT ON COLUMN Category.Id IS 'Primary Key';<br />COMMENT ON COLUMN Category.Name IS 'A common name for this category.';<br />COMMENT ON COLUMN Category.Description IS 'A longer description of this category.';<br /><br />--- Create the oracle sequence for the primary key<br />CREATE SEQUENCE CategoryIdSeq INCREMENT BY 1 NOMAXVALUE MINVALUE 1 NOCYCLE NOCACHE NOORDER;<br /><br />--- Create the oracle trigger for populating the primary key<br />CREATE OR REPLACE TRIGGER SetCategoryIdPk<br />BEFORE INSERT ON Category REFERENCING OLD AS OLD NEW AS NEW FOR EACH ROW  <br />BEGIN  <br />IF  :new.Id IS NULL THEN  <br />SELECT CategoryIdSeq.Nextval INTO :new.Id FROM dual;  <br />END IF;  <br />END; <br />/<br /><br />--- insert initial categories<br />INSERT INTO Category (Name, Description)VALUES('Groceries','My grocery list items');<br />INSERT INTO Category (Name, Description)VALUES('Work','My work related items');<br />COMMIT;<br /></div><br />So what does this deployment script do?<br />1. Creates a table for us to store categories<br />2. Creates a primary key column<br />3. Sets comments on the table and the columns (Comments?! Madness!!)<br />4. Creates a sequence to drive the primary key value (oracle specific goo)<br />5. Creates a trigger to populate the primary key value based on the sequence<br />6. inserts 2 new categories: Groceries and Work.<br /><br />Basically, it does literally everything that needs to be done to get the Category table setup in the database for my initial web application release to work.<br /><br />So now, every time we deploy our web application to a new environment, we can run this SQL script to guarantee that a category table is created exactly how we expect it to be, along with its initial data.<br /><br /><div class="sidenote"><b>Cant I just reverse engineer the database when I'm done my project?</b><br />Yes! ... Maybe! >_> just be careful that you don't reverse engineer throw-away testing data. I've seen that happen a lot just because people don't like spending the up front time building SQL scripts. <br /></div><br /><b>Example SQL Script for Deployment of a Web Application Update</b><br /><br />After deploying our initial version of the web application, we start working on the next version which requires updates to the database. New requirements state that the categories now need to be sorted in an arbitrary order -and- we have additional categories being added to this release. Awesome!  Lets script out the updates to our category table so that again we will have a reliable, repeatable process for deploying our changes.<br /><br /><div class="code">--- Give our table a SortOrder column<br />ALTER TABLE Category ADD SortOrder INT NULL;<br />COMMENT ON COLUMN Category.SortOrder IS 'The default order in which categories should be displayed to the user.';<br /><br />--- Update existing data with sort order values<br />UPDATE Category SET SortOrder = 1 WHERE Name = 'Work';<br />UPDATE Category SET SortOrder = 2 WHERE Name = 'Groceries';<br /><br />--- Insert new data, include sort order values<br />INSERT INTO Category (Name, Description,SortOrder)VALUES('Errands','Errand that I need to do',3);<br />COMMIT;<br /></div><br />Cool? So this SQL script, to be used for the next deployment of this application, is completely different from the initial deployment SQL Script - We only care about things that changed from the initial deployment script. This new SQL script should be bundled with the deployment package for this version of the web application.  <br /><br />Just to review, These are the changes we just made in english:<br /><br />1. Gave the Category table a new SortOrder column<br />2. Updated our existing records in the Category table with a SortOrder value<br />3. Inserted a new category, including its SortOrder value<br /><br /><b>And the point of all this is...?</b><br /><br />Hopefully it's obvious to you at this point - It's a good practice to Use SQL scripts to deploy ALL database changes for your application.  The reward for your up front effort is a repeatable and reliable deployment script.  An added bonus - you even can hand off your SQL scripts to a database admin to deploy remotely! (its a good practice to do that anyway!)