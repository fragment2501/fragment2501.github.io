---
layout: post
title: 'Kinit Fails to Generate Keytab - Exception: krb_error 14 - in Windows 2008R2
  Domain'
date: '2010-12-20T14:48:00.001-08:00'
author: Bryan
tags: 
modified_time: '2010-12-20T14:48:24.589-08:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-8895760936788697620
blogger_orig_url: http://www.bryansgeekspeak.com/2010/12/kinit-fails-to-generate-keytab.html
---

I ran into this issue specifically when setting up a kerberos ticket for the Teamworks 6.2.2 (jboss) service account running on windows 2003R2 in a windows 2008R2 domain.  The reason I need kerberos here is so that a Web Part on a SharePoint 2010 server can pass through authentication from the user (the infamous doublehop delegation issue).<br /><br />Windows 2008R2 domain controllers no longer support the older DES encryption used by Teamworks 6.x for Kerberos ticket encryption (DES-CBC-CRC).  Bamf. Roadblock.<br /><br />Here is the error I get when I try to run the kinit command to setup the Kerberos ticket for the Teamworks service account:<br /><br /><div class="code">C:\Program Files (x86)\Support Tools>C:\Teamworks\java_x64\bin\kinit -k -t C:\t<br />amworks\sso.keytab HTTP/TWServer@MYDOMAIN.LOCAL<br />Exception: krb_error 14 KDC has no support for encryption type (14) KDC has no<br />upport for encryption type<br />KrbException: KDC has no support for encryption type (14)<br />at sun.security.krb5.KrbAsRep.<init>(KrbAsRep.java:66)<br />at sun.security.krb5.KrbAsReq.getReply(KrbAsReq.java:486)<br />at sun.security.krb5.internal.tools.Kinit.sendASRequest(Kinit.java:308)<br />at sun.security.krb5.internal.tools.Kinit.<init>(Kinit.java:239)<br />at sun.security.krb5.internal.tools.Kinit.main(Kinit.java:106)<br />Caused by: KrbException: Identifier doesn't match expected value (906)<br />at sun.security.krb5.internal.KDCRep.init(KDCRep.java:133)<br />at sun.security.krb5.internal.ASRep.init(ASRep.java:58)<br />at sun.security.krb5.internal.ASRep.<init>(ASRep.java:53)<br />at sun.security.krb5.KrbAsRep.<init>(KrbAsRep.java:50)<br />... 4 more<br /></div><br />krb_error 14 points to an issue with the encryption types. Googling led me to the fact that Windows 2008R2 no longer supports DES encryption types used by Teamworks/jboss.<br /><br />From there I tried enabling a workaround posted by Microsoft but it doesnâ€™t seem to have any effect, even after rebooting all servers in the domain:<br /><br /><a href="http://support.microsoft.com/kb/977321">http://support.microsoft.com/kb/977321</a><br /><br />As a last ditch effort, I ended up adding a windows 2003R2 BDC to my domain and tried pointing kinit to the new BDC.  It worked.  When I ran the kinit command, it automatically picked up the BDC instead of the PDC and generated the ticket successfully.  After that, everything came up fine - Kerberos authentication worked from IIS/SharePoint 2010 to Teamworks, giving me SSO from my teamworks inbox webpart.