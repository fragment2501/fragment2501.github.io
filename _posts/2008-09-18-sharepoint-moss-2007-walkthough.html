---
title: SharePoint MOSS 2007 - Walkthough Customizing a CQWP Instance
date: '2008-09-18T12:13:00.001-07:00'
author: Bryan
tags:
- MOSS
modified_time: '2008-09-22T15:25:41.781-07:00'
thumbnail: http://4.bp.blogspot.com/_It8-g3_9vec/SNLSpfEu-YI/AAAAAAAAAbM/cha5NyencTg/s72-c/1_homepage.jpg
blogger_id: tag:blogger.com,1999:blog-19111454.post-774494185638779662
blogger_orig_url: http://www.bryansgeekspeak.com/2008/09/sharepoint-moss-2007-walkthough.html
---

<div class="sidenote">A high level overview of customizing a CQWP and links to other info and examples can be found <a href="http://bryansgeekspeak.blogspot.com/2008/04/sharepoint-moss-2007-customizing.html">here</a>.</div><br /><br />For this article, we'll do a simple tutorial on customizing the Content Query Web Part (CQWP) that comes out of the box with MOSS.   We'll start with a brand new site collection based on the <b>Team Site Template</b>. We'll then create a new custom list with our own custom columns. Once we've added some data to our custom list, we'll then create a customized CQWP instance to display those custom columns for our data.  <br /><br />So, go ahead and create your new site or site collection and login to the default page for that site.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SNLSpfEu-YI/AAAAAAAAAbM/cha5NyencTg/s1600-h/1_homepage.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SNLSpfEu-YI/AAAAAAAAAbM/cha5NyencTg/s320/1_homepage.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488125997873538" /></a><br /><br />Lets start by creating a new SharePoint library where we will store a few documents for use in our CQWP.  We'll customize this library with new columns that we want to use to filter by and display in our CQWP output.<br /><br /><div class="sidenote">Keep in mind that a SharePoint <b>Library</b> is a special kind of SharePoint <b>List</b>.  They both act like lists, and you will see me sometimes refer to a Library as a List.</div><br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLSpuP3YYI/AAAAAAAAAbU/z405o_3yiVU/s1600-h/2_create_document_library.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLSpuP3YYI/AAAAAAAAAbU/z405o_3yiVU/s320/2_create_document_library.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488130071093634" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SNLSpk-yjbI/AAAAAAAAAbc/GLdKRmsDGHY/s1600-h/3_create_document_library.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SNLSpk-yjbI/AAAAAAAAAbc/GLdKRmsDGHY/s320/3_create_document_library.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488127583554994" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLSp9KOheI/AAAAAAAAAbk/6yJrLRJOYeo/s1600-h/4_document_library_settings.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLSp9KOheI/AAAAAAAAAbk/6yJrLRJOYeo/s320/4_document_library_settings.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488134073976290" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SNLSqK4T8AI/AAAAAAAAAbs/vKjPy5dSrUc/s1600-h/5_document_library_settings.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SNLSqK4T8AI/AAAAAAAAAbs/vKjPy5dSrUc/s320/5_document_library_settings.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488137756930050" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTCgXvTeI/AAAAAAAAAb0/Shf1H25Kn6s/s1600-h/6_custom_column.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTCgXvTeI/AAAAAAAAAb0/Shf1H25Kn6s/s320/6_custom_column.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488555842751970" /></a><br /><br /><div class="sidenote">Take note of the custom column name I chose.  No spaces or special characters are used, and there is a good reason for this.  To reference spaces and special characters in a .webpart file or the .xsl file can be tricky, so its best to just avoid using them at all in your custom column names.</div><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTC7cGsyI/AAAAAAAAAb8/8-0NVSH22RM/s1600-h/7_custom_column_2.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTC7cGsyI/AAAAAAAAAb8/8-0NVSH22RM/s320/7_custom_column_2.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488563108819746" /></a><br /><br />Note that the 2nd column called <b>BDLLabel</b> should be set to "Display choices using: <b>Checkboxes (allow multiple selections)</b>.  Leave the rest of the options to the defaults.<br /><br />With all our custom columns in place, add some new documents to the list we just created.  In the next few screens, I'm adding a word document and taking advantage of Microsoft Office 2007's ability to connect to the SharePoint server to view and edit document metadata.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNLTDfDB8FI/AAAAAAAAAcE/HMiEIjrxK_Q/s1600-h/8_new_sharepoint_doc_1.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNLTDfDB8FI/AAAAAAAAAcE/HMiEIjrxK_Q/s320/8_new_sharepoint_doc_1.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488572667326546" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNLTDVM9okI/AAAAAAAAAcM/XAgHtFOlBpw/s1600-h/9_new_sharepoint_doc_1.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNLTDVM9okI/AAAAAAAAAcM/XAgHtFOlBpw/s320/9_new_sharepoint_doc_1.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488570024632898" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTDvFvR6I/AAAAAAAAAcU/5wd6kUd-pjs/s1600-h/10_doc_library.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTDvFvR6I/AAAAAAAAAcU/5wd6kUd-pjs/s320/10_doc_library.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247488576973653922" /></a><br /><br />If you dont have Microsoft Office 2007, you can still edit metadata through the browser interface as shown below.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTiZmXl0I/AAAAAAAAAcc/vVcS13hZR8A/s1600-h/11_new_sqlserver_doc.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTiZmXl0I/AAAAAAAAAcc/vVcS13hZR8A/s320/11_new_sqlserver_doc.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489103780878146" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTiqPWW9I/AAAAAAAAAck/mw7jtywlPg8/s1600-h/12_doc_library.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTiqPWW9I/AAAAAAAAAck/mw7jtywlPg8/s320/12_doc_library.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489108247731154" /></a><br /><br />Now that we have a few documents in our library to work with, we can go to work on creating and customizing a CQWP instance for our list.  On the site home page, drop in a CQWP, then modify it to show records from our custom list.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTipO2eHI/AAAAAAAAAcs/B9RTSBMt0zw/s1600-h/13_cqwp.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SNLTipO2eHI/AAAAAAAAAcs/B9RTSBMt0zw/s320/13_cqwp.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489107977205874" /></a><br /><br />Now export that bad boy to a .webpart file on your local machine.  The file is plain text XML, so you can edit it in your favorite text editor.  In the screens below, I use Visual Studio to add our custom columns to the <b>CommonViewFields</b> property, which makes our custom columns available to our XSL style sheets for this web part instance.  We'll use the XSL style sheets later to display the custom column data.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTiwV6JOI/AAAAAAAAAc0/udHb1t2DpzY/s1600-h/14_export_cqwp.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNLTiwV6JOI/AAAAAAAAAc0/udHb1t2DpzY/s320/14_export_cqwp.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489109885854946" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SNLTjN9j7gI/AAAAAAAAAc8/OcHQHIGt9Ig/s1600-h/15_edit_webpart_xml.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SNLTjN9j7gI/AAAAAAAAAc8/OcHQHIGt9Ig/s320/15_edit_webpart_xml.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489117836799490" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SNLUHmVyEqI/AAAAAAAAAdE/E-iUp--LTHU/s1600-h/16_edit_webpart_xml.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SNLUHmVyEqI/AAAAAAAAAdE/E-iUp--LTHU/s320/16_edit_webpart_xml.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489742856131234" /></a><br /><br />Save your changes to the hacked up .webpart file and then import that bad boy back into the home page.  And yes, we now have another web part instance on the page in addition to the one we exported earlier.  If you changed the title in the .webpart file, that will display in your new web part instance's chrome so you can tell them apart.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SNLUH5g87hI/AAAAAAAAAdM/O5fHc2zvhf8/s1600-h/17_import_webpart.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SNLUH5g87hI/AAAAAAAAAdM/O5fHc2zvhf8/s320/17_import_webpart.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489748003253778" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SNLUICLjuvI/AAAAAAAAAdU/jQqteq1kA5E/s1600-h/18_import_webpart.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SNLUICLjuvI/AAAAAAAAAdU/jQqteq1kA5E/s320/18_import_webpart.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489750329441010" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNLUIJTa-3I/AAAAAAAAAdc/N_bd5LX33Eg/s1600-h/19_import_webpart_done.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNLUIJTa-3I/AAAAAAAAAdc/N_bd5LX33Eg/s320/19_import_webpart_done.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5247489752241470322" /></a><br /><br />At this point, we could safely delete the web part instance we exported from ... or you can just let it sit there to see how different our customized version will look in comparison.  Whatever.  But at this point, we are done modifying the .webpart file (at least for now >_>).  We now have access to our custom columns, so now lets move on to rendering them as part of the CQWP output.<br /><br />You'll need to break out SharePoint Designer at this point, login to your site and checkout/edit <b>\Style Library\XSL Style Sheets\ItemStyle.xsl</b><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNe7-TD7LwI/AAAAAAAAAds/gd58ojD8SPA/s1600-h/20_add_itemstyle_xsl.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNe7-TD7LwI/AAAAAAAAAds/gd58ojD8SPA/s320/20_add_itemstyle_xsl.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5248870569666621186" /></a><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQU60Z1I/AAAAAAAAAd0/tWpv2Bvu5sM/s1600-h/21_xsl_edit_0.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQU60Z1I/AAAAAAAAAd0/tWpv2Bvu5sM/s320/21_xsl_edit_0.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5248884073542477650" /></a><br /><br />Looking at the <b>&lt;xsl:template&gt;</b> tags, look for one named "Bullets". We'll customize a copy of that template for our own use.  Remember, try to avoid customizing any of the out of the box SharePoint templates.  Always try to customize a copy where you can.<br /><br />All we want to do is change the name of our new style template to <b>BryansStyle</b> and add our custom description from the .webpart file, <b>BDLLongDescription</b>, to the template.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQrvHTvI/AAAAAAAAAd8/4Xko07K46f0/s1600-h/22_xsl_edit_1.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQrvHTvI/AAAAAAAAAd8/4Xko07K46f0/s320/22_xsl_edit_1.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5248884079667400434" /></a><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQ0Pu8qI/AAAAAAAAAeE/m-JLshImvyI/s1600-h/23_xsl_edit_2.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SNfIQ0Pu8qI/AAAAAAAAAeE/m-JLshImvyI/s320/23_xsl_edit_2.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5248884081951699618" /></a><br /><br />now save and check in <b>ItemStyle.xsl</b> and go back to the webpage.  Put the page in edit mode and modify the customized CQWP.  Under the <b>Presentation</b> section, change the <b>Item Style</b> to <b>BryanStyle</b> and click Apply to see the custom description show up in the CQWP results.<br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SNfIRF8olzI/AAAAAAAAAeM/mcMgEmGQga0/s1600-h/24_xsl_apply.jpg"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SNfIRF8olzI/AAAAAAAAAeM/mcMgEmGQga0/s320/24_xsl_apply.jpg" border="0" alt=""id="BLOGGER_PHOTO_ID_5248884086703429426" /></a><br /><br />And thats it!  After doing that a few times, you get the basic idea.  Create a custom column, add it to a list. Drop in some data.  Export a webpart, customize it, and re-import it. Hack up the ItemStyle.xsl to support the new column.  Bam! Done!<br /><br />Keep in mind, this is a pretty easy example.  Not much XSL formatting, no query customizations based on our column and we used a very simple datatype.  I'll try to touch on these points in the next few posts ... working with dates and date formatting is probably what most people use, so I'll do that in one of my next few posts.<br /><br />Continue on to <a href="http://bryansgeekspeak.blogspot.com/2008/09/moss-custom-cqwp-exploring-mulitchoice.html">Exploring the MultiChoice column</a>.