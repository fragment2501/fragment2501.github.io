---
layout: post
title: 'Custom Workflow Architecture: Examining Workflow Data'
date: '2010-07-27T12:45:00.000-07:00'
author: Bryan
tags:
- Workflow
modified_time: '2010-07-27T12:46:12.232-07:00'
thumbnail: http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s72-c/Workflow_Step_Trans_Tables2.JPG
blogger_id: tag:blogger.com,1999:blog-19111454.post-1821940358852310974
blogger_orig_url: http://www.bryansgeekspeak.com/2010/07/custom-workflow-architecture-examining.html
---

<b>!!ROUGH DRAFT!!</b><br /><br /><div class="sidenote">This post expands on a previous post: <a href="http://www.bryansgeekspeak.com/2010/07/custom-workflow-architecture-workflow.html">Custom Workflow Architecture: Workflow Steps and Transitions</a><br /></div><br />From the previous post, we should already have the following database tables created and populated with the data shown:<br /><br /><b>Database Tables</b><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s1600/Workflow_Step_Trans_Tables2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="162" src="http://2.bp.blogspot.com/_It8-g3_9vec/TE8tcen7SNI/AAAAAAAAAzc/FigDPlpqvkc/s400/Workflow_Step_Trans_Tables2.JPG" width="400" /></a></div><br /><b>Records</b><br /><br /><div class="code">SELECT  *<br />FROM  Workflow;</div><br /><table border="0" cellpadding="0" cellspacing="0"><tbody><tr> <th>ID</th>  <th>NAME</th>  <th>DESCRIPTION</th> </tr></tbody><tbody id="data"><tr> <td align="right">1</td> <td>Vacation Request Workflow</td> <td>A workflow to allow employees to request vacation time.</td>  </tr></tbody></table><br /><div class="code">SELECT  *<br />FROM  WorkflowStep;</div><br /><table border="0" cellpadding="0" cellspacing="0"><tbody><tr> <th>ID</th>  <th>WORKFLOWID</th>  <th>NAME</th>  <th>DESCRIPTION</th> </tr></tbody><tbody id="data"><tr> <td align="right">1</td> <td align="right">1</td> <td>Workflow Instance Instantiated</td> <td>This step marks the point where a workflow instance was created.</td>  </tr><tr> <td align="right">2</td> <td align="right">1</td> <td>Request Creation/Submission</td> <td>A vacation request is created and submitted for approval at this step.</td>  </tr><tr> <td align="right">3</td> <td align="right">1</td> <td>Manager Review/Approval</td> <td>The vacation request is reviewed and approved/rejected by a manager at this step.</td>  </tr><tr> <td align="right">4</td> <td align="right">1</td> <td>Workflow Completed</td> <td>The vacation request was finalized (Either approved or rejected).</td>  </tr></tbody></table><br /><div class="code">SELECT  *<br />FROM  WorkflowTrans;</div><br /><table border="0" cellpadding="0" cellspacing="0"><tbody><tr> <th>ID</th>  <th>WORKFLOWID</th>  <th>FROMSTEPID</th>  <th>TOSTEPID</th>  <th>NAME</th>  <th>DESCRIPTION</th> </tr></tbody><tbody id="data"><tr> <td align="right">1</td> <td align="right">1</td> <td align="right">1</td> <td align="right">2</td> <td>Instantiate Workflow</td> <td>The initial transition that fires off for every new workflow.</td>  </tr><tr> <td align="right">2</td> <td align="right">1</td> <td align="right">2</td> <td align="right">3</td> <td>Submit For Manager Approval</td> <td>Submit the request for approval.</td>  </tr><tr> <td align="right">3</td> <td align="right">1</td> <td align="right">3</td> <td align="right">4</td> <td>Approved by Manager</td> <td>Approve Request.</td>  </tr></tbody></table><br /><b>Queries</b><br /><br />Now lets start extracting some more meaningful data.  The above queries give us raw dumps of all our tables, so we can at least see all our workflows, steps and transitions. But it does not give us the details our users and managers will want to see.  So here are some common questions and solutions for querying data from our workflow data repository.<br /><br /><b>I need to see a list of all steps ordered by their logical flow within the workflow, starting with the step "Workflow Instance Instantiated" and ending with whatever the final workflow step happens to be, for this workflow instance. How can I do that?</b><br /><br />The trick is to know what your starting transition is.  Our transitions map the workflow from one step to another, so if we know what the first step is, we can follow our transitions to the end point. Writing the SQL to walk workflow transitions is trickier than it sounds.  Its really a parent/child relationship. In my examples here, I use the built in oracle functions for traversing hierarchical relationships - START WITH and CONNECT BY.<br /><br /><div class="sidenote">In these examples, for simplicity, I'm hardcoding the starting step ID into my queries.  In a more complete example, I would want to store the starting step ID somewhere in the database as part of the workflow scheme.  For example, we could track the start step ID as part of the workflow record by creating a new column: Workflow.StartStepID.<br /></div><br /><div class="code">SELECT  w.Name AS WorkflowName,<br />ws.Name AS StepName, <br />wt.Name AS TransName,<br />LEVEL<br />FROM  Workflow w<br />INNER JOIN WorkflowStep ws ON ws.WorkflowID = w.ID<br />INNER JOIN WorkflowTrans wt ON wt.FromStepID = ws.ID AND wt.WorkflowID = w.ID<br />WHERE w.ID = 1<br />START WITH wt.FromStepID = 1<br />CONNECT BY PRIOR wt.ToStepID = wt.FromStepID<br />ORDER BY LEVEL;</div><br /><table border="0" cellpadding="0" cellspacing="0"><tbody><tr> <th>WORKFLOWNAME</th>  <th>STEPNAME</th>  <th>TRANSNAME</th>  <th>LEVEL</th> </tr></tbody><tbody id="data"><tr> <td>Vacation Request Workflow</td> <td>Workflow Instance Instantiated</td> <td>Instantiate Workflow</td> <td align="right">1</td>  </tr><tr> <td>Vacation Request Workflow</td> <td>Request Creation/Submission</td> <td>Submit For Manager Approval</td> <td align="right">2</td>  </tr><tr> <td>Vacation Request Workflow</td> <td>Manager Review/Approval</td> <td>Approved by Manager</td> <td align="right">3</td>  </tr></tbody></table><br />I use the START BY statement to tell oracle what the starting point is for traversing the workflow I've designed. The table that represents the workflow hierarchy is really only the WorkflowTrans table, where the FromStepID and ToStepId represent our parent/child keys.  So, we tell oracle to walk the transition hierarchy, and we use oracle's built in LEVEL keyword to sort our results correctly. This gives us a tabular representation of how our workflow is linked by transitions.<br /><br /><!--- CUSTOM CSS FOR TABLES ON THIS PAGE ---><br /><style type="text/css">table { background-color:#F2F2F5; border-width:1px 1px 0px 1px; border-color:#C9CBD3; border-style:solid; } td { color:#000000; font-family:Tahoma,Arial,Helvetica,Geneva,sans-serif; font-size:9pt; background-color:#EAEFF5; padding:8px; background-color:#F2F2F5; border-color:#ffffff #ffffff #cccccc #ffffff; border-style:solid solid solid solid; border-width:1px 0px 1px 0px; } th { font-family:Tahoma,Arial,Helvetica,Geneva,sans-serif; font-size:9pt; padding:8px; background-color:#CFE0F1; border-color:#ffffff #ffffff #cccccc #ffffff; border-style:solid solid solid none; border-width:1px 0px 1px 0px; white-space:nowrap; } </style>