---
layout: post
title: Teamworks 6.2.1 Active Directory Integration Notes
date: '2009-06-25T14:34:00.000-07:00'
author: Bryan
tags:
- Teamworks
modified_time: '2009-06-25T16:09:54.458-07:00'
thumbnail: http://3.bp.blogspot.com/_It8-g3_9vec/SkP2GhPzhZI/AAAAAAAAAsw/1Zds8TgypWI/s72-c/1_vm_sandbox.JPG
blogger_id: tag:blogger.com,1999:blog-19111454.post-7019807648460639920
blogger_orig_url: http://www.bryansgeekspeak.com/2009/06/teamworks-621-active-directory.html
---

The most difficult thing about setting up AD Integration for Teamworks was figuring out how information is stored in my AD tree.  I started by building out a sandbox windows network with a single Primary Domain Controller (PDC) for the domain "WBSSANDBOX", then adding an oracle server and a Teamworks server, both joined to the domain.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SkP2GhPzhZI/AAAAAAAAAsw/1Zds8TgypWI/s1600-h/1_vm_sandbox.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 144px;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SkP2GhPzhZI/AAAAAAAAAsw/1Zds8TgypWI/s320/1_vm_sandbox.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5351391374110590354" /></a><br /><br />With Teamworks 6.2.1 running stable, I went to setup AD integration and found it needs to connect via raw LDAP queries.  I then realized I had no idea what LDAP objects were in AD so I couldn't set proper Distinguished Names for LDAP queries.  I needed a tool to peek at the raw AD tree, since the windows AD tools like "Active Directory Users and Computers" don't give you exact LDAP Distinguished Names for users and groups.  I ended up downloading <a href="http://www.ldapbrowser.com/download.htm">LDAP Browser 2.6</a> (a free tool as of this writing) to connect to the AD tree using connection settings shown below (where wbssandbox.com in my true sandox domain name, and WBSSANDBOX is my pre-win2000 domain name).<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SkP2Gz99vBI/AAAAAAAAAs4/XZwgRp_I86g/s1600-h/2_pdc_ldap_debuging_setup.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 274px;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SkP2Gz99vBI/AAAAAAAAAs4/XZwgRp_I86g/s320/2_pdc_ldap_debuging_setup.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5351391379136035858" /></a><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SkP2HGFc2YI/AAAAAAAAAtA/ZetdPZEmDtI/s1600-h/3_pdc_ldap_debuging_setup2.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 275px;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SkP2HGFc2YI/AAAAAAAAAtA/ZetdPZEmDtI/s320/3_pdc_ldap_debuging_setup2.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5351391383999273346" /></a><br /><br />With the raw LDAP data in hand, I turned to configuring Teamworks. There are only two config files to update: <br /><ul><br /><li>[teamworks-install-path]/process-server/resources/config/100Custom.xml</li><br /><li>[teamworks-install-path]/process-server/conf/login-config.xml</li><br /></ul><br />100Custom.xml was an easy copy and paste, as shown in one of the Lombardi Teamworks configuration guides. I just added a chunk of code shown below within the &lt;Properties&gt; tag:<br /><br /><div class="code">&lt;common merge=&quot;mergeChildren&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;security merge=&quot;mergeChildren&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;access-controller-manager&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;access-controller merge=&quot;append&quot;&gt;com.lombardisoftware.userorg.JBossLdapExtUserRegistryModule&lt;/access-controller&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/access-controller-manager&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/security&gt;<br />&lt;/common&gt;<br /></div><br />login-config.xml was the tricky one, because you need to know your AD LDAP structure to make the changes.  There is a commented out Active Directory LDAP example in that config file, I ended up modifying that to get things working as shown below.<br /><br /><div class="code">&lt;login-module code=&quot;org.jboss.security.auth.spi.LdapExtLoginModule&quot; flag=&quot;optional&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;java.naming.provider.url&quot;&gt;ldap://<span style="background:yellow">192.168.0.210</span>:389/&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;bindDN&quot;&gt;<span style="background:yellow">cn=TeamworksService,CN=Users,DC=WBSSANDBOX,DC=com</span>&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;bindCredential&quot;&gt;<span style="background:yellow">your password here</span>&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;baseCtxDN&quot;&gt;<span style="background:yellow">cn=Users,DC=WBSSANDBOX,DC=com</span>&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;baseFilter&quot;&gt;(sAMAccountName={0})&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;roleFilter&quot;&gt;(member={1})&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;rolesCtxDN&quot;&gt;<span style="background:yellow">cn=Users,DC=WBSSANDBOX,DC=com</span>&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;roleAttributeID&quot;&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;roleAttributeIsDN&quot;&gt;false&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;roleNameAttributeID&quot;&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;password-stacking&quot;&gt;useFirstPass&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;java.naming.referral&quot;&gt;follow&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;allowEmptyPasswords&quot;&gt;false&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Teamworks UserOrg config. --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Filter for user objects --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twUserFilter&quot;&gt;(objectClass=person)&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Filter for group objects --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupFilter&quot;&gt;(objectClass=group)&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the name of a user --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twUserNameAttribute&quot;&gt;sAMAccountName&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the PrimaryGroupID of a user (omit this option if no such attribute exists) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twUserPrimaryGroupAttribute&quot;&gt;primaryGroupID&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the name of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupNameAttribute&quot;&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the distinguishedname of a group (used for resolving nested groups) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupDNAttribute&quot;&gt;distinguishedName&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the primaryGroupToken of a group (omit this option if no such attribute exists) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupPrimaryGroupTokenAttribute&quot;&gt;primaryGroupToken&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the description of a user --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twUserDescriptionAttribute&quot;&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the description of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupDescriptionAttribute&quot;&gt;description&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the members of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name=&quot;twGroupMemberAttribute&quot;&gt;member&lt;/module-option&gt;<br />&lt;/login-module&gt;<br /></div><br />To really break down what your values should be, you'll need to take a peek at your LDAP structure and see where things are.  For example, I got hung up on the idea that users and groups would be in separate containers in AD, but as it turns out they're both stored in the Users container.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_It8-g3_9vec/SkP2HRzNoaI/AAAAAAAAAtI/HwKZ7WHGbEs/s1600-h/4_pdc_ldap_AD_UsersAndGroups.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 234px;" src="http://4.bp.blogspot.com/_It8-g3_9vec/SkP2HRzNoaI/AAAAAAAAAtI/HwKZ7WHGbEs/s320/4_pdc_ldap_AD_UsersAndGroups.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5351391387144004002" /></a><br /><br />Once you have all the correct LDAP info set for your domain, save both files and restart your Teamworks service. You can then confirm AD Integration is working by browsing to the Teamworks admin console. Login as the tw_admin account and browse to the "Maintain Logical Roles" screen, you should see your domain groups listed along with the ootb Teamworks roles.  You can then try adding Domain Admins to the tw_admins logical role, logout and then try to login as the domain administrator to confirm authentication works.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SkQAId_9OYI/AAAAAAAAAtQ/b6oWvD8RyeI/s1600-h/5_teamworks_admin_console.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 246px;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SkQAId_9OYI/AAAAAAAAAtQ/b6oWvD8RyeI/s320/5_teamworks_admin_console.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5351402402714827138" /></a>