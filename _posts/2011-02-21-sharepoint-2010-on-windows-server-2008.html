---
title: SharePoint 2010 on Windows Server 2008 R2 with Kerberos Troubleshooting
date: '2011-02-21T11:07:00.000-08:00'
author: Bryan
tags:
- SharePoint 2010
- Kerberos
- Teamworks
modified_time: '2011-02-21T11:07:03.418-08:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-7563873243626047568
blogger_orig_url: http://www.bryansgeekspeak.com/2010/11/sharepoint-2010-on-windows-server-2008.html
---

<div class="sidenote">re-posted again with additional resource links at the botttom.</div><br />Wow.  Going through some massive headaches getting kerberos setup in SharePoint 2010 on Windows Server 2008 R2.  I was following my old guide from SharePoint 2007 (<a href="http://www.bryansgeekspeak.com/2010/01/enabling-kerberos-in-windows-domain-for.html">http://www.bryansgeekspeak.com/2010/01/enabling-kerberos-in-windows-domain-for.html</a>) until I realized all the IIS 7.5 settings are completely different...<br /><br />The first thing google turned up for me was an blog post that explains a lot of Windows 2008R2 specific gotchas for SharePoint 2010.  It goes into detail about how to turn off kernel mode authentication and how to enable IIS delegation using the application pool account credentials.<br /><br /><a href="http://www.harbar.net/archive/2010/03/31/sharepoint-2010-and-kerberos.aspx">http://www.harbar.net/archive/2010/03/31/sharepoint-2010-and-kerberos.aspx</a><br /><br />With those changes and some SETSPN commands I was able to get successful kerberos logon events to the SharePoint 2010 web front end. A good start. On to the double hop delegation from a SharePoint 2010 web part to Teamworks 6...<br /><br />When I hit the Teamworks webpart in SharePoint 2010, I got the usual authentication error that tells me kerberos is not working. The Teamworks server is already working in a SharePoint 2007 farm though, so I know the Teamworks piece is good - but I can see with wireshark that only NTLM2 requests are being sent from the SharePoint 2010 WFE to the jboss server - no kerberos traffic at all.<br /><br /><b>Dec 22, 2010 Update! Limited Success!</b><br />In one of my isolated SharePoint 2010 dev farms (an 8 server farm, isolated in its own domain), I was able to get kerberos working with Teamworks after working around the kinit/kerberos encryption issue (see the kinit link in the resources section).  I have not had any success in larger, more complex domains. I'm now exploring the MS whitepaper on implementing kerberos (see link in resources section) hoping a solution will leap out at me *crosses fingers!*<br /><br /><b>LINKS TO KERBEROS RESOURCES</b><br /><ul><li><a href="http://support.microsoft.com/kb/262177">How to enable Kerberos event logging</a></li><li><a href="http://www.bryansgeekspeak.com/2010/12/kinit-fails-to-generate-keytab.html">http://www.bryansgeekspeak.com/2010/12/kinit-fails-to-generate-keytab.html</a> - Due to the Windows 2008R2 PDCs no longer supporting older DES encryption types used by Teamworks/jboss, kinit fails to generate keytab file for the Teamworks service account.</li><li><a href="http://www.bryansgeekspeak.com/2010/12/debugging-windows-server-2008r2-event.html">http://www.bryansgeekspeak.com/2010/12/debugging-windows-server-2008r2-event.html</a> for if you find the error in the event logs "Event ID 6037 - The target name used is not valid" on the SharePoint 2010 WFE (possible SPN error)</li><li>Microsoft's <a href="http://technet.microsoft.com/en-us/library/ff829837.aspx">Configuring Kerberos authentication for SharePoint 2010 Products (white paper)</a></li><li><a href="http://www.k2underground.com/blogs/johnny/archive/2007/12/07/k2-blackpearl-hf2-01-distributed-installations.aspx">K2 [blackpearl] HF2.01 Distributed Installations (and also SP1)</a> - Even though its specific to K2, its a good reference for farm configuration with kerberos/spns</li></ul>