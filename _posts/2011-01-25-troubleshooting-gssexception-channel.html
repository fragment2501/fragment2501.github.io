---
layout: post
title: 'Troubleshooting GSSException: Channel binding mismatch (Mechanism level: ChannelBinding
  not provided!)'
date: '2011-01-25T08:57:00.000-08:00'
author: Bryan
tags:
- JBoss
- Kerberos
- Teamworks
- SharePoint
modified_time: '2011-01-25T08:57:34.043-08:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-4593137816447998420
blogger_orig_url: http://www.bryansgeekspeak.com/2011/01/troubleshooting-gssexception-channel.html
---

Ran into another interesting error in one of my SharePoint 2007 farms with kerberos enabled.  Our Teamworks web part, which uses kerberos to authenticate to the Teamworks (jboss) workflow server suddenly stopped working after a series of patches were applied to all the servers in the farm.  Nothing obvious was showing up in the windows event logs, but I did find this error in the Teamworks logs<br /><br /><div class="code">java.lang.RuntimeException: Exception verifying Kerberos token<br /> at org.jboss.security.auth.AdvancedWebCallbackHandler$1.run(AdvancedWebCallbackHandler.java:236)<br /> at java.security.AccessController.doPrivileged(Native Method)<br /> at javax.security.auth.Subject.doAs(Subject.java:337)<br /> at org.jboss.security.auth.CommonKerberosUtils.doAsKerberosSubject(CommonKerberosUtils.java:64)<br /> at org.jboss.security.auth.AdvancedWebCallbackHandler.handleNegotiateCallback(AdvancedWebCallbackHandler.java:211)<br /> at org.jboss.security.auth.AdvancedWebCallbackHandler.handleCallbacks(AdvancedWebCallbackHandler.java:151)<br /> at org.jboss.security.auth.AdvancedWebCallbackHandler.handle(AdvancedWebCallbackHandler.java:107)<br /> at org.jboss.security.auth.HttpServletRequestResponseValve.doNegotiate(HttpServletRequestResponseValve.java:382)<br /> at org.jboss.security.auth.HttpServletRequestResponseValve.authenticate(HttpServletRequestResponseValve.java:263)<br /> at org.jboss.security.auth.HttpServletRequestResponseValve.authenticate(HttpServletRequestResponseValve.java:237)<br /> at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)<br /> at org.jboss.security.auth.HttpServletRequestResponseValve.invoke(HttpServletRequestResponseValve.java:128)<br /> at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)<br /> at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)<br /> at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)<br /> at org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:392)<br /> at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)<br /> at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)<br /> at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)<br /> at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)<br /> at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)<br /> at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)<br /> at java.lang.Thread.run(Thread.java:595)<br />Caused by: <mark>GSSException: Channel binding mismatch (Mechanism level: ChannelBinding not provided!)</mark><br /> at sun.security.jgss.krb5.InitialToken$OverloadedChecksum.<init>(InitialToken.java:225)<br /> at sun.security.jgss.krb5.InitSecContextToken.<init>(InitSecContextToken.java:102)<br /> at sun.security.jgss.krb5.Krb5Context.acceptSecContext(Krb5Context.java:715)<br /> at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:300)<br /> at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:246)<br /> at org.jboss.security.auth.AdvancedWebCallbackHandler$1.run(AdvancedWebCallbackHandler.java:226)<br /> ... 22 more<br /></div><br />Google lead me to this forum thread:<br /><br /><a href="http://forums.sdn.sap.com/thread.jspa?threadID=1504390&start=15&tstart=0">http://forums.sdn.sap.com/thread.jspa?threadID=1504390&start=15&tstart=0</a><br /><br />Apparently one of the server patches we applied changed the SharePoint server's "Extended Protection for Authentication" behavior (<a href="http://support.microsoft.com/?scid=kb;en-us;968389&x=10&y=18">http://support.microsoft.com/?scid=kb;en-us;968389&x=10&y=18</a>), which was causing kerberos to fail for our Teamworks Web Part.<br /><br />We ended up adding the registry key "SuppressExtendedProtection" as a DWORD type with a value of "2" to the node "HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\LSA" on the SharePoint web front end where the Web Part was running. After a reboot, it fixed our problem.