---
title: ".NET SQL Query Results to a DataTable Type"
date: '2010-11-04T12:39:00.000-07:00'
tags:
- ".NET"
- Oracle
modified_time: '2010-11-04T12:43:00.724-07:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-8113628445977219958
blogger_orig_url: http://www.bryansgeekspeak.com/2010/11/net-sql-query-results-to-datatable-type.html
---

So, all I want to do is execute an SQL statement against oracle and have it return a recordset that I can use in my .NET code, just like what I'm used to seeing in Coldfusion. What's the best way to do that? <br /><br />I spent hours experimenting with DataAdapter and DataReader (The Oracle ODAC112012 version), and I was able to get useable results using several different techniques, all with their own pros and cons. DataAdaper is huge and provides an amazing amount of extra functionality for Insert/update/delete functionality that we really don't need in this case. DataReader on the other hand seems to be optimized for forward read access of sql select results, but only while actively connected to the database. I really want a combination of the two in this case â€“ the speed/optimization of the DataReader with the Functionality of a DataTable (which to me, is very similar to a Coldfusion recordset), which is returned as part of a DataSet by a DataAdapter. <br /><br />My favorite solution so far? A DataReader filling a newly initialized DataTable. Another requirement for me is the support of SQL Parameters, which automatically prevents SQL injection attacks and improves DB server performance with query plan caching (you get that for free just by using sql parameters for ALL your variables rather than relying on string parsing! Yay!). Anywho, here is a fairly generic method that allows executing a SQL statement along with its list of OracleParameters, returning only one DataTable variable with the results of the query: <br /><br /><br /><div class="code">public DataTable executeSqlDataTable(string sql, OracleParameter[] sqlParameters)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;// Get the connection string<br />&nbsp;&nbsp;&nbsp;&nbsp;ConnectionStringSettings connectionStringSettings = ConfigurationManager.ConnectionStrings[&quot;OracleConnectionStringCouncil&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;string constr = connectionStringSettings.ConnectionString;<br />&nbsp;&nbsp;&nbsp;&nbsp;DataTable dt = new DataTable();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;// Create an oracle connection<br />&nbsp;&nbsp;&nbsp;&nbsp;using (OracleConnection conn = new OracleConnection(constr))<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create an oracle command object so we can pass parameters to it<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OracleCommand command = new OracleCommand(sql, conn);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add parameters, if any<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (int i = 0; i &lt; sqlParameters.Length; i++)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command.Parameters.Add(sqlParameters[i]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// execute the sql statement<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.Open();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OracleDataReader dr = command.ExecuteReader(CommandBehavior.CloseConnection);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// dump the results to a DataTable type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dt.Load(dr);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return dt;<br />}<br /></div><br /><br />And here is an example method that executes a sql statement (with oracle SQL parameters) and returns one column value from the first returned row as a result: <br /><br /><div class="code">public string getFullName(string ntUsername)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;string sql = &quot;SELECT FULL_NAME FROM MyUserTable WHERE username = :ntUsername&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;// Set SQL parameters<br />&nbsp;&nbsp;&nbsp;&nbsp;OracleParameter[] sqlParameters = { new OracleParameter(&quot;ntUsername&quot;,OracleDbType.NVarchar2) };<br />&nbsp;&nbsp;&nbsp;&nbsp;sqlParameters[0].Value = ntUsername;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;// Execute the SQL, return a DataTable<br />&nbsp;&nbsp;&nbsp;&nbsp;DataTable tt = executeSqlDataTable(sql, sqlParameters );<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return tt.Rows[0][&quot;FULL_NAME&quot;].ToString();&nbsp;&nbsp; <br />}<br /></div>