---
layout: post
title: VS2010 deployments using TFS2010 Build Server
date: '2011-03-04T15:24:00.000-08:00'
author: Bryan
tags:
- TFS 2010
modified_time: '2011-03-15T11:38:37.747-07:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-7051902739319672571
blogger_orig_url: http://www.bryansgeekspeak.com/2011/03/vs2010-deployments-using-tfs2010-build.html
---

<div class="sidenote">Placeholder for TFS2010 Build notes</div><br /><br /><h2>My TFS2010 Build Server Config</H2><ul><li>Windows Server 2008R2 x64</li><li>Installed Application Server role, including .NET 3.5.1 and .NET 4</li><li>Installed TFS2010 Controller service and 1 Build Agent Service</li><li>Configured TFS Controller service to run under custom domain account, no special privileges assigned in advance ([domain]\TFSBuildSVC)</li><li>Installed VisualStudio 2010 Ultimate (with C#, Web Developer and SharePoint tools)</li><li>Put Oracle.DataAccess.dll (2.112.1.0) into GAC to support oracle connections (used in our web projects)</li><li>Installed SharePoint 2010 resources for building SharePoint 2010 projects in TFS2010 (<a href="http://msdn.microsoft.com/en-us/library/ff622991.aspx">http://msdn.microsoft.com/en-us/library/ff622991.aspx</a>). I used the powershell script provided by microsoft to copy over/setup the TFS server (<a href="http://blogs.msdn.com/b/vssharepointtoolsblog/archive/2010/04/14/building-visual-studio-sharepoint-projects-using-team-foundation-build.aspx">http://blogs.msdn.com/b/vssharepointtoolsblog/archive/2010/04/14/building-visual-studio-sharepoint-projects-using-team-foundation-build.aspx</a>)</li><li>Installed <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d2928bc1-f48c-4e95-a064-2a455a22c8f6&displaylang=en">ASP.NET MVC 3 RTM</a></li></ul><br /><h2>Enable web.config Transforms for TFS 2010 Builds</H2><p>Found this solution on <a href="http://kjdaly.com/Blog/Details/5">Kevin Daly's Blog</a>. Unfortunately it involves editing the project/solution files to make it work.</p><br /><ol><li>Make a master list of build targets for the projects in your solution. Assuming all build targets will be used in at least one web.config transform, you'll need to keep track of them for use later in the TFS build definition.</li><li>In your TFS build definition, go to the Process section and add the build configurations from step 1 to the "Items to build->Configurations to Build" section. Be sure to define the configurations exactly as you have then in your solution.</li><li>In the solution explorer, unload the project you want to add the transform to, then right click the project name and edit the project file.  Add the following XML chunk just before the last &lt;/Project&gt; tag:<br /><div class="code">&lt;Target Name=&quot;AfterBuild&quot; Condition=&quot;$(IsAutoBuild)=='True'&quot;&gt;<br />&lt;ItemGroup&gt;<br />&lt;DeleteAfterBuild Include=&quot;$(WebProjectOutputDir)\Web.*.config&quot; /&gt;<br />&lt;/ItemGroup&gt;<br />&lt;TransformXml Source=&quot;Web.config&quot; Transform=&quot;$(ProjectConfigTransformFileName)&quot; Destination=&quot;$(WebProjectOutputDir)\Web.config&quot;/&gt;<br />&lt;Delete Files=&quot;@(DeleteAfterBuild)&quot; /&gt;<br />&lt;/Target&gt;<br /></div></li><li>Edit the TFS build definition again. In the "process" section, go to "Advanced->MSBuild Arguments" and add the following parameter<br /><div class="code">/p:IsAutoBuild="True"<br /></div></ol><p>That should do the trick.  Run the build and if it succeeds, open the drop folder and browse into the "_PublishedWebsites" folder. Find your project and check the web.config to confirm it produced the right results.</p><h2>Create Web Deploy Package with TFS</H2><p>To create a Web Deploy package for your project in the drop folder, you need to throw a few more MSBuild parameters into the TFS build definition.</p><div class="code">/P:CreatePackageOnPublish=true /P:DeployOnBuild=true </div><p>These switches just create the package on the filesystem.  Also, your project "Package/Publish Web" settings should be configured in VS2010 (usually the defaults are fine).</p><hr><h2>Build Server Errors</H2><ul><li><div class="code">... The imported project "C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v10.0\WebApplications\Microsoft.WebApplication.targets" was not found. Confirm that the path in the &lt;Import&gt; declaration is correct, and that the file exists on disk.</div>This error means that the build box is missing some files required to perform the project MSBuild.  In this case, I was trying to perform a web.config xml transform for a VisualStudio 2010 web application project. I was able to fix the issue by installing VS2010 on the build box. I'm guessing its a safe bet to install your typical workstation development tools on the build box to make sure that all your build requirements are met.<br /></li></ul><h2>Resources</H2><ul><li>Web deployment switches for TFS2010 builds: <br /><a href="http://weblogs.asp.net/jdanforth/archive/2010/04/24/package-and-publish-web-sites-with-tfs-2010-build-server.aspx">http://weblogs.asp.net/jdanforth/archive/2010/04/24/package-and-publish-web-sites-with-tfs-2010-build-server.aspx</a></li><li><a href="http://msdn.microsoft.com/en-us/library/ff622991.aspx">How to build SharePoint Projects with TFS Team Build</a></li><li><a href="http://nickhoggard.wordpress.com/tag/continuous-integration/">TFS Web Deployment Packages (and other info about continuous integration)</a></li><li>More TFS2010 MSBuild deployment switches: <a href="http://vishaljoshi.blogspot.com/2010/11/team-build-web-deployment-web-deploy-vs.html">Team Build + Web Deployment + web Deploy + VS2010 = Goodness</a></li></ul>