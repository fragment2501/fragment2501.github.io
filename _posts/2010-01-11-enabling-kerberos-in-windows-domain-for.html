---
title: Enabling Kerberos in a Windows Domain for SharePoint 2007 and Teamworks
date: '2010-01-11T13:40:00.000-08:00'
tags:
- Kerberos
- Teamworks
- SharePoint
modified_time: '2010-11-24T14:22:38.426-08:00'
thumbnail: http://2.bp.blogspot.com/_It8-g3_9vec/S0uSRqH6LOI/AAAAAAAAAwQ/zlDeWmpEy00/s72-c/KRBDomainDiagram.jpg
blogger_id: tag:blogger.com,1999:blog-19111454.post-6984912802020344094
blogger_orig_url: http://www.bryansgeekspeak.com/2010/01/enabling-kerberos-in-windows-domain-for.html
---

Notes for configuring Kerberos on a windows 2000/2003 domain for SharePoint 2007 farms.<br /><br /><div class="sidenote">For a list of gotchas in a SharePoint 2010/Windows server 2008 setup, check out this post: <a href="http://www.bryansgeekspeak.com/2010/11/sharepoint-2010-on-windows-server-2008.html">http://www.bryansgeekspeak.com/2010/11/sharepoint-2010-on-windows-server-2008.html</a></div><br />This post explains how I setup a sandbox network configured specifically for testing SharePoint 2007 and Teamworks 6.2.2 using Kerberos authentication on a windows domain.  <br /><br />I used a 5 server setup in this example, including a SharePoint farm (a web application server and a sql server), a teamworks server farm (a teamworks application server and an oracle server) and a primary domain controller.  The goal, as shown in the diagram below, is allow domain users to auto-login to to the SharePoint portal.  From the SharePoint portal we want to be able to drop the Teamworks for SharePoint web part into a SharePoint page, set it to use integrated authentication in order to pass along the user's SharePoint credentials along to the Teamworks server.  The end result is a SSO auto login for the user.  They should only need to login to their workstation and not see a login prompt in their browser for access to the portal or Teamworks.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/S0uSRqH6LOI/AAAAAAAAAwQ/zlDeWmpEy00/s1600-h/KRBDomainDiagram.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_It8-g3_9vec/S0uSRqH6LOI/AAAAAAAAAwQ/zlDeWmpEy00/s320/KRBDomainDiagram.jpg" /></a><br /></div><br />To start, you'll need to get to a point where you have all the servers up and running as shown in the model.  The server configuration is outlined below, before I began configuring Kerberos.<br /><br /><b>Server Software Configuration Prerequisite</b><br /><ul><li>KDCPDC</li><ul><li>Microsoft Windows 2003 R2 Enterprise Edition</li><li>Configured as Primary Domain Controller</li></ul><li>KDCSQL2008</li><ul><li>Microsoft Windows 2003 R2 Enterprise Edition</li><li>MS SQL Server 2008 (2005 works just as well) patched to the latest version, configured for use in your sharepoint farm.</li></ul><li>KDCMOSS</li><ul><li>Microsoft Windows 2003 R2 Enterprise Edition</li><li>MOSS SharePoint 2007 patched with SP2, configured using custom user accounts. (note that I've heard kerberos is much easier to configure if you use the default service accounts rather than creating custom accounts)</li></ul><li>KDCOracle</li><ul><li>Microsoft Windows 2003 R2 Enterprise Edition</li><li>Oracle Server 10.2.0.4 configured for use with Teamworks 6.2.2</li></ul><li>KDCTW</li><ul><li>Microsoft Windows 2003 R2 Enterprise Edition</li><li>Teamworks 6.2.2 Enterprise Edition</li></ul></ul><br />With the above server configuration, we then need the names of the service accounts for Teamworks and the SharePoint web application pool where the teamworks web part will be used.<br /><br /><br /><table border="1"><tbody><tr> <th>Account Name<br /></th> <th>Description<br /></th> </tr><tr> <td>KRB\MOSSAppPool<br /></td> <td>SharePoint Web Application Pool Account<br /></td> </tr><tr> <td>KRB\Teamworks<br /></td> <td>Teamworks Service Account<br /></td> </tr></tbody></table><br />Finally, we need to know the fully qualified URLs for each of our web sites - the SharePoint URL and the Teamworks Portal url.&nbsp; In this case, I added DNS records on the PDC for these URLS:<br /><br /><table border="1"><tbody><tr> <th>URL<br /></th> <th>Description<br /></th> </tr><tr> <td>www.krb.com<br /></td> <td>The sharepoint site (remember, only use the PDC as the DNS server!)<br /></td> </tr><tr> <td>krbtw.krb.com<br /></td> <td>Teamworks Portal URL<br /></td> </tr></tbody></table><br />With all the above information, we can now start configuring kerberos.<br /><br /><h1>Part 1 - Service Principal Names (SPN)</h1>With delegation enabled, we need to map SPNs for the service accounts, to show kerberos that we allow trust those accounts to perform trusted authentication. You need to have the windows 2003 server support tools installed in order to run this command.<br /><br /><div class="code">c:&gt;setspn -A HTTP/www.krb.com KRB\MossAppPool<br /></div><br /><div class="code">c:&gt;setspn -A HTTP/krbtw.krb.com@KRB.COM KRB\Teamworks<br /></div><br />When you are done, you can use setspn to list spn mappings for machines and accounts on your domain, which should look similar to what is shown below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_It8-g3_9vec/S0uy1pttT6I/AAAAAAAAAxA/YJXz3EhDmSU/s1600-h/Part2-setspn_list.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_It8-g3_9vec/S0uy1pttT6I/AAAAAAAAAxA/YJXz3EhDmSU/s320/Part2-setspn_list.JPG" /></a><br /></div><br /><h1>Part 2 - AD Account Delegation</h1>Enable Delegation rights in AD for the SharePoint computer account, the SharePoint application pool account and the Teamworks service account.<br /><br /><h2>Computer Accounts</h2><br /><div class="sidenote">Note that these examples are for a domain set to a functional level of windows 2000.  If your domain functional level is set to windows 2003, delegation works differently.<br /></div><br />We only need to configure the SharePoint computer account.  The Teamworks server uses a java server application, which will require a different method for enabling kerberos trust/delegation, so dont enable trust delegation for the Teamworks computer account.<br /><br /><h3>With Domain Functional Level Set to Windows 2000 <br /></h3><br />For the computer account KRBMOSS, check the option "Trust computer for delegation".<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_It8-g3_9vec/S0uersQ9shI/AAAAAAAAAwg/qf3uew3B-_0/s1600-h/part1-computer_accounts.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_It8-g3_9vec/S0uersQ9shI/AAAAAAAAAwg/qf3uew3B-_0/s320/part1-computer_accounts.JPG" /></a><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0uenNv9VhI/AAAAAAAAAwY/gmxG-M-f0Lo/s1600-h/part1-sharepoint_computer_account.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0uenNv9VhI/AAAAAAAAAwY/gmxG-M-f0Lo/s320/part1-sharepoint_computer_account.JPG" /></a><br /></div><br /><br /><h3>With Domain Functional Level Set to Windows 2003<br /></h3><br />For the computer account KRBMOSS, goto the "Delegation" tab, select the option "Trust this computer for delegation to the specified services only" and "User kerberos only".  Then add the HTTP service, with a computer account of the sharepoint web site.  To add the url of the sharepoint web site, you need to click "Add.." and select the SharePoint application pool user account, where we mapped an SPN for that account to the SharePoint site URL.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S1Dul0TVc5I/AAAAAAAAAys/AqWwQDAuDy8/s1600-h/Part2-krbmoss_constrained_delegation.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S1Dul0TVc5I/AAAAAAAAAys/AqWwQDAuDy8/s320/Part2-krbmoss_constrained_delegation.JPG" /></a><br /></div><br /><br /><br /><h2>Enable Delegation for Service Accounts</h2><br /><div class="sidenote">Note that constrained delegation works differently. Changes need to be made under the "Delegation" tab in the account properties.<br /></div><br /><h3>With Domain Functional Level Set to Windows 2000</h3><br />Check the option "Account is trusted for delegation" for both service accounts. In addition, the Teamworks service account needs the option "Use DES encryption types for this account" checked in order to support Teamworks (I believe this is a java server kerberos requirement).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/S0ug9WWjMyI/AAAAAAAAAwo/dPezJ19omio/s1600-h/part1-service_account.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_It8-g3_9vec/S0ug9WWjMyI/AAAAAAAAAwo/dPezJ19omio/s320/part1-service_account.JPG" /></a><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/S0uhAjxyrCI/AAAAAAAAAww/85Mvee2u5eE/s1600-h/part1-sharepoint_service_account.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_It8-g3_9vec/S0uhAjxyrCI/AAAAAAAAAww/85Mvee2u5eE/s320/part1-sharepoint_service_account.JPG" /></a><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/S0uhF0S1k4I/AAAAAAAAAw4/xCsdQhEVEOc/s1600-h/part1-teamworks_service_account.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_It8-g3_9vec/S0uhF0S1k4I/AAAAAAAAAw4/xCsdQhEVEOc/s320/part1-teamworks_service_account.JPG" /></a><br /></div><br /><h3>With Domain Functional Level Set to Windows 2003<br /></h3><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S1Dzdo327JI/AAAAAAAAAy0/YDLosNuCRao/s1600-h/Part2-mossapppool_constrained_delegation.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S1Dzdo327JI/AAAAAAAAAy0/YDLosNuCRao/s320/Part2-mossapppool_constrained_delegation.JPG" /></a><br /></div><br /><h1>Part 3 - Enable Kerberos in SharePoint</h1>Now the easy part! Log into the SharePoint Central Administration site.  Under "Application Management" goto the "Authentication Providers" page.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_It8-g3_9vec/S0u0NEyjeqI/AAAAAAAAAxI/-qdGfFJrliQ/s1600-h/part3-sharepoint_auth_providers.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_It8-g3_9vec/S0u0NEyjeqI/AAAAAAAAAxI/-qdGfFJrliQ/s320/part3-sharepoint_auth_providers.JPG" /></a>&nbsp; <br /></div><br />Select correct web application from teh "Web Application" drop down, then click the "Default" zone.&nbsp; Check "Negotiate (kerberos)" under the heading "IIS Authentication Settings" and click "Save".<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_It8-g3_9vec/S0u25c5Vr_I/AAAAAAAAAxQ/MYUeAMiYIos/s1600-h/part3-sharepoint_auth_provider_negotiate.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_It8-g3_9vec/S0u25c5Vr_I/AAAAAAAAAxQ/MYUeAMiYIos/s320/part3-sharepoint_auth_provider_negotiate.JPG" /></a><br /></div><br />You'll get a confirmation windows telling you that there are other steps required as domain administrator to enable kerberos.&nbsp; You can ignore that, we did that in the previous steps by setting the SPNs and configuring delegation.&nbsp; Be sure to execute an "iisreset" command at the command prompt after enabling negotiate.<br /><br /><div class="code">c:\&gt;iisreset /noforce<br /></div><br />And that's all there is to it for the SharePoint side of things.  You can confirm Kerberos is working by logging into the SharePoint site (http://www.krb.com).  Then check the event viewer's security logs on the SharePoint server. You should see a 540 event for the user you hit the site as, with a message indicating kerberos authentication was used, similar to that shown below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0u5Nl1T2rI/AAAAAAAAAxg/9OKJfRIeYVg/s1600-h/part3-sharepoint_admin_login.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0u5Nl1T2rI/AAAAAAAAAxg/9OKJfRIeYVg/s320/part3-sharepoint_admin_login.JPG" /></a><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0u47pcjqLI/AAAAAAAAAxY/7PQTlUxdWiw/s1600-h/part3-sharepoint_security_log.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0u47pcjqLI/AAAAAAAAAxY/7PQTlUxdWiw/s320/part3-sharepoint_security_log.JPG" /></a><br /></div><br /><br /><h1>Part 4 - Enable Kerberos in Teamworks</h1><br />Start by shutting down your Teamworks Process Server. It's also a good idea to delete all the log files before you start making changes.  In this example, log files are in "c:\Teamworks\process-server\logs\".<br /><br /><h2>Create Kerberos Config File for Teamworks</h2><br />First, we need to create a kerberos config file on the windows server which Teamworks/Jboss can find, in order contact the KDC properly.  The Teamworks SSO documentation explains that Teamworks/Jboss is already configured to look for a file called krb5.ini in the path "C:\winnt\krb5.ini".  The content of that text file should look like this, for our example KRB domain:<br /><br /><div class="code">[libdefaults]<br />default_realm = KRB.COM<br />default_tkt_enctypes = des-cbc-crc<br />default_tgs_enctypes = des-cbc-crc<br />ticket_lifetime = 600<br />[realms]<br />KRB.COM = {<br />kdc = KRBPDC<br />admin_server = KRBPDC<br />default_domain = krb.com<br />}<br />[domain_realm]<br />.domain.com = KRB.COM<br />[appdefaults]<br />autologin = true<br />forward = true<br />forwardable = true<br />encrypt = true<br /></div><br />Once you've created the file "C:\winnt\krb5.ini" with the above text, you can continue to the next step.<br /><br /><h2>Create Kerberos Token with KTPASS <br /></h2><br />As the domain administrator, login to the Teamworks server (KRBTW) and run the following command from the command prompt:<br /><br /><div class="code">ktpass -out sso.keytab -princ HTTP/krbtw.krb.com@KRB.COM -pass MYPASSWORD -mapuser KRB\Teamworks -crypto DES-CBC-CRC -ptype KRB5_NT_PRINCIPAL<br /></div><br />Be sure to replace "MYPASSWORD" with the password of your KRB\Teamworks account.  <br /><br />Note that the "-princ" value matches the SPN we created earlier for the Teamworks service account.<br /><br />If the command is successful, the file "sso.keytab" will be created in your current directory.  Copy that file to your Teamworks installation directory.  In this example, I copied the file to "c:\Teamworks\sso.keytab".<br /><br /><h2>Generate Kerberos Ticket for Teamworks Account</h2><br />Login to the Teamworks server (KRBTW) as the Teamworks service account (KRB\Teamworks) and run the following command from a command prompt, again assuming that you installed Teamworks to "c:\Teamworks":<br /><br /><div class="code">c:\Teamworks\java\bin\kinit.exe -k -t c:\Teamworks\sso.keytab HTTP/krbtw.krb.com@KRB.COM<br /></div><br />If the kinit command is successful, it will create a kerberos ticket in the following path which will then be used for kerberos authentication by the Teamworks service from now on.<br /><br /><div class="code">C:\Documents and Settings\Teamworks\krb5cc_sso<br /></div><br /><h2>Turn On Kerberos in Teamworks</h2><br />As described in the Teamworks SSO documentation, we now need to enable kerberos in Teamworks.  In this example, we also enable KRB domain users and groups within Teamworks, so that we can manage Teamworks accounts through AD.<br /><br /><ul><li>c:\Teamworks\process-server\conf\login-config.xml</li></ul>Change the &lt;application-policy name="other"&gt; element to match the following. Be sure to change "MYPASSWORD" and "ENCRYPTEDPASSWORD" to values that work for your accounts.  For information on how to encrypt passwords for Teamworks, refer to the Teamworks install documentation from Lombardi.<br /><br /><div class="code">&lt;application-policy name="other"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;authentication&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Uncomment and configure for SSO autologin --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;login-module code="org.jboss.security.auth.NegotiateLoginModule" flag="optional"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="loadBalance"&gt;false&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="domainController"&gt;KRBPDC&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="defaultDomain"&gt;KRB&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="java.security.krb5.realm"&gt;KRB.COM&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="jcifs.http.enableNegotiate"&gt;true&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="jcifs.spnego.servicePrincipal"&gt;HTTP/krbtw.krb.com@KRB.COM&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="jcifs.spnego.servicePassword"&gt;ENCRYPTEDPASSWORD&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/login-module&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;login-module code="com.lombardisoftware.security.provider.authentication.jboss.TWInternalLoginModuleImpl" flag="optional"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/login-module&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Example Active Directory LDAP config --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;login-module code="org.jboss.security.auth.spi.LdapExtLoginModule" flag="optional" &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="java.naming.provider.url"&gt;ldap://KRBPDC:389/&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="bindDN"&gt;cn=Teamworks,CN=Users,DC=KRB,DC=com&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="bindCredential"&gt;MYPASSWORD&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="baseCtxDN"&gt;cn=Users,DC=KRB,DC=com&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="baseFilter"&gt;(sAMAccountName={0})&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="roleFilter"&gt;(member={1})&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="rolesCtxDN"&gt;cn=Users,DC=KRB,DC=com&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="roleAttributeID"&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="roleAttributeIsDN"&gt;false&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="roleNameAttributeID"&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;module-option name="allowEmptyPasswords"&gt;false&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Teamworks UserOrg config. --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Filter for user objects --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twUserFilter"&gt;(objectClass=person)&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Filter for group objects --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupFilter"&gt;(objectClass=group)&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the name of a user --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twUserNameAttribute"&gt;sAMAccountName&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the PrimaryGroupID of a user (omit this option if no such attribute exists) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twUserPrimaryGroupAttribute"&gt;primaryGroupID&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the name of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupNameAttribute"&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the distinguishedname of a group (used for resolving nested groups) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupDNAttribute"&gt;distinguishedName&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the primaryGroupToken of a group (omit this option if no such attribute exists) --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupPrimaryGroupTokenAttribute"&gt;primaryGroupToken&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the description of a user --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twUserDescriptionAttribute"&gt;cn&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the description of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupDescriptionAttribute"&gt;description&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Attribute in LDAP that contains the members of a group --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="twGroupMemberAttribute"&gt;member&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/login-module&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;login-module code="com.lombardisoftware.security.provider.authentication.jboss.TWAuthenticatedRoleLoginModuleImpl" flag="required"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="authenticatedRole"&gt;twuser&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/login-module&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;login-module code="org.jboss.security.ClientLoginModule" flag="required"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="password-stacking"&gt;useFirstPass&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;module-option name="restore-login-identity"&gt;true&lt;/module-option&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/login-module&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/authentication&gt;<br />&lt;/application-policy&gt;<br /></div><br /><ul><li>c:\Teamworks\process-server\conf\jboss-service.xml</li></ul>Uncomment the AdvancedWebCallbackHandler as shown.<br /><br /><div class="code">&lt;!-- Uncomment for SSO auto-login --&gt;<br /><br />&lt;attribute name="CallbackHandlerClassName"&gt;org.jboss.security.auth.AdvancedWebCallbackHandler&lt;/attribute&gt;<br /><br /></div><br /><ul><li>c:\Teamworks\process-server\applications\portal.war\WEB-INF\context.xml</li></ul>Modify to match the following code.<br /><br /><div class="code">&lt;Context&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- uncomment and configure appropriately for SSO autologin --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;Valve className="org.jboss.security.auth.HttpServletRequestResponseValve"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainName="KRB"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainControllerAddress="KRBPDC"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadBalance="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalName="HTTP/krbtw.krb.com@KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalPassword="ENCRYPTEDPASSWORD"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbRealm="KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNegotiate="true"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNtlm="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useBasic="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; basicRealm="TWRealm"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userValidatorClass="com.lombardisoftware.userorg.JBossAutologinValidator"/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;Valve className="org.apache.catalina.authenticator.FormAuthenticator" characterEncoding="UTF-8" /&gt;<br />&lt;/Context&gt;<br /></div><br /><ul><li>c:\Teamworks\process-server\applications\teamworks.ear\teamworks.war\WEB-INF\context.xml</li></ul>Modify to match the following code.<br /><br /><div class="code">&lt;Context&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- uncomment and configure appropriately for SSO autologin --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;Valve className="org.jboss.security.auth.HttpServletRequestResponseValve"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainName="KRB"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainControllerAddress="KRBPDC"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadBalance="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalName="HTTP/krbtw.krb.com@KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalPassword="ENCRYPTEDPASSWORD"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbRealm="KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNegotiate="true"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNtlm="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useBasic="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; basicRealm="TWRealm"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userValidatorClass="com.lombardisoftware.userorg.JBossAutologinValidator"/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;Valve className="org.apache.catalina.authenticator.FormAuthenticator" characterEncoding="UTF-8" /&gt;<br />&lt;/Context&gt;<br /></div><br /><ul><li>c:\Teamworks\process-server\applications\webapi.war\WEB-INF\context.xml</li></ul>Modify to match the following code.<br /><br /><div class="code">&lt;Context&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- uncomment and configure appropriately for SSO autologin --&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;Valve className="org.jboss.security.auth.HttpServletRequestResponseValve"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainName="KRB"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domainControllerAddress="KRBPDC"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loadBalance="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalName="HTTP/krbtw.krb.com@KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbServicePrincipalPassword="ENCRYPTEDPASSWORD"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; krbRealm="KRB.COM"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNegotiate="true"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useNtlm="false"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; useBasic="true"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; basicRealm="TWRealm"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userValidatorClass="com.lombardisoftware.userorg.JBossAutologinValidator"/&gt;<br />&lt;/Context&gt;<br /></div><br />Thats the last of the Teamworks configuration changes.  Restart your process server and check the logs to confirm there are no errors.  Next, you will want to login to the teamworks admin site (http:\\krbtw.krb.com\teamworks) as tw_admin to confirm AD groups are visible to Teamworks.  From the Teamworks admin portal, go to the "Maintain Logical Roles" page. You should see your domain groups populating the "Available Roles" box as shown below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_It8-g3_9vec/S0y3uF3nZuI/AAAAAAAAAxo/Rs3aTs7hqog/s1600-h/part4-confirm_ad_groups_in_teamworks.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/_It8-g3_9vec/S0y3uF3nZuI/AAAAAAAAAxo/Rs3aTs7hqog/s320/part4-confirm_ad_groups_in_teamworks.JPG" /></a>&nbsp; <br /></div><br />Once you've confirmed groups are showing up properly, try logging in to the portal site from another computer as a domain user using IE.  Be sure to add the url "krbtw.krb.com" to the browser's Local Intranet zone first, to confirm that you are logging in via SSO\Kerberos. You'll know it's working if you see the "Attempting auto-login" screen flash briefly (shown in the screenshot below) before dumping you into the Teamworks portal.  If you get a windows password prompt, of if you get the Teamworks form password prompt, you'll know you've hit a problem.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_It8-g3_9vec/S0y5Eo6YuTI/AAAAAAAAAxw/1j_rwkdu9aU/s1600-h/part4-teamworks_autologin_screen.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/_It8-g3_9vec/S0y5Eo6YuTI/AAAAAAAAAxw/1j_rwkdu9aU/s320/part4-teamworks_autologin_screen.JPG" /></a><br /></div><br /><br /><h1>Part 5 - Install Teamworks Web Part</h1><br /><div class="sidenote">For this example, we will assume the IIS directory path for the web application is located here "c:\Inetpub\wwwroot\wss\VirtualDirectories\80\"<br /></div><br /><h2>Run Teamworks for SharePoint Installer</h2><br />I ran the installer as the SharePoint farm administrator. I typically use the same account that was used to run the SharePoint installer and the SharePoint configuration wizard.  <br /><br /><div class="sidenote">I haven't confirmed this, but there seem to be cases where the Teamworks Site Templates in SharePoint are not available, and I think it may have to do with the account used to run the installer.<br /></div><br />The SharePoint for Teamworks installer is fairly self explanatory. You need to know the URL of your teamworks server (and the port used for web access, if it is not port 80).  I always choose -not- to let the installer modify any configuration files because of several possible bugs with the installer. I feel its safer to manually perform these steps, as shown in this post.<br /><br /><h2>Move Teamworks Web Part DLLs to Web Application Bin</h2><br />On the SharePoint server (KRBMOSS), search for the Teamworks Web Part assemblies and copy them to the web application bin directory, so that your web application can actually use them.  The version of Teamworks for SharePoint I am using installs the assemblies to c:\windows. Both files that need to be copied from<br /><br /><ul><li>c:\windows\Lombardi.Server.WebParts.dll</li><li>c:\windows\Lombardi.Server.WebParts.Portal.dll</li></ul><br />to<br /><br /><ul><li>c:\Inetpub\wwwroot\wss\VirtualDirectories\80\bin\Lombardi.Server.WebParts.dll</li><li>c:\Inetpub\wwwroot\wss\VirtualDirectories\80\bin\Lombardi.Server.WebParts.Portal.dll</li></ul><br /><div class="sidenote">This step should not be necessary.  This seems to be a bug with the version of the Teamworks for SharePoint installer that I'm using. One of these days I'll get around to asking Lombardi Teamworks support about it.<br /></div><br /><h2>Modify Web Application web.config File</h2><br />For the next few steps in this example, we are editing the following file for our web application.<br /><br /><div class="code">c:\Inetpub\wwwroot\wss\VirtualDirectories\80\web.config<br /></div><br /><h3>Add Teamworks Web Part Assemblies to Safe Controls</h3><br />In web.config, add the Teamworks assemblies as safe controls.<br /><br />This may change as new versions of the Teamworks for Sharepoint assemblies are released. You may need to confirm the version number and public key token for yourself to get this part working.  Check with Lombardi support if you get stuck on this.<br /><br /><div class="code">&lt;SafeControls&gt;<br />...<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;SafeControl Assembly="Lombardi.Server.WebParts, Version=1.1.74.0, Culture=neutral, PublicKeyToken=6a9d7f68474317de" Namespace="Lombardi.Server.WebParts" TypeName="*" Safe="True" /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;SafeControl Assembly="Lombardi.Server.WebParts.Portal, Version=1.1.74.0, Culture=neutral, PublicKeyToken=b45d0da702028bb7" Namespace="Lombardi.Server.WebParts.Portal" TypeName="*" Safe="True" /&gt;<br />&lt;/SafeControls&gt;<br /></div><br /><div class="sidenote">I believe this is also a bug with the installer.  I would think the installer should create these SafeControl entries for you in web.config since the installer does not tell you the version number or PublicKeyToken of the assemblies.<br /></div><br /><h3>Set Trust Level</h3><br />In web.config, you will need to set the trust level to something that will work for the Teamworks assemblies.  For testing, I simply set the trust level to "full" as shown below.<br /><br /><div class="code">&lt;trust level="Full" originUrl="" /&gt;<br /></div><br /><h2>Configure SharePoint Site to Allow Teamworks Web Parts</h2><br />Login to the sharepoint site as an administrator, then go to the site collection root and add the Lombardi Teamworks Web Parts to the Web Part gallery.<br /><br />From the site collection settings page, click "Web Parts" under "Galleries".<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0zNfW5bd-I/AAAAAAAAAx4/4QbGETahco0/s1600-h/part5-teamworks_webparts_gallery.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0zNfW5bd-I/AAAAAAAAAx4/4QbGETahco0/s320/part5-teamworks_webparts_gallery.JPG" /></a><br /></div><br />Click the "New" button in the Web Part Gallery list page.<br /><br /><div class="separator" style="clear: both; text-align: center;">&nbsp;<a href="http://4.bp.blogspot.com/_It8-g3_9vec/S0zNwhkv-CI/AAAAAAAAAyA/V9z7G13Bc3E/s1600-h/part5-teamworks_webparts_gallery2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_It8-g3_9vec/S0zNwhkv-CI/AAAAAAAAAyA/V9z7G13Bc3E/s320/part5-teamworks_webparts_gallery2.JPG" /></a><br /></div><br />Check the box next to each Lombardi.* Web Part, then click "Populate Gallery" to make them available in the site collection for use.<br /><br /><div class="separator" style="clear: both; text-align: center;">&nbsp;<a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0zNz7nFWVI/AAAAAAAAAyI/5ZAKUgREVxc/s1600-h/part5-teamworks_webparts_gallery3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0zNz7nFWVI/AAAAAAAAAyI/5ZAKUgREVxc/s320/part5-teamworks_webparts_gallery3.JPG" /></a><br /></div><br /><h2>Confirm Integrated Authentication Works for Web Part</h2><br />From a page of your site, edit the page and add the TeamworksSavedSearch Web Part to the page.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_It8-g3_9vec/S0zc7jPPuNI/AAAAAAAAAyQ/OOmiSk0FPwg/s1600-h/part5-add_teamworks_webpart_1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_It8-g3_9vec/S0zc7jPPuNI/AAAAAAAAAyQ/OOmiSk0FPwg/s320/part5-add_teamworks_webpart_1.JPG" /></a><br /></div><br />Configure the Web Part for Integrated Authentication Mode.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_It8-g3_9vec/S0zdSe98c2I/AAAAAAAAAyY/cXz9o0vuwOo/s1600-h/part5-add_teamworks_webpart_2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/_It8-g3_9vec/S0zdSe98c2I/AAAAAAAAAyY/cXz9o0vuwOo/s320/part5-add_teamworks_webpart_2.JPG" /></a><br /></div><br />If kerberos is working properly, you should see results similar to the following when you click "Apply" or "Ok" after configuring the Web Part.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_It8-g3_9vec/S0zdkdjvFdI/AAAAAAAAAyg/FXYL1RNwRXA/s1600-h/part5-add_teamworks_webpart_3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_It8-g3_9vec/S0zdkdjvFdI/AAAAAAAAAyg/FXYL1RNwRXA/s320/part5-add_teamworks_webpart_3.JPG" /></a><br /></div><br /><h1>The End!</h1><br />If you were successful, pat yourself on the back and go buy yourself a mocha!  Honestly, many people have trouble configuring kerberos on small server farms about this size, and once you get into things like reporting services and load balancing, it gets much more complicated.  <br /><br />When planning and testing kerberos configurations, I suggest always starting with a small example like this one, using all VMs (I use VMWare ESXi 4.0 currently for all my VMs). Once you get a working sandbox network, make a copy of your VM's so you can restore to a known good configuration for kerberos. Then you can safely start your experimenting.  Build your more complex scenarios from this known good working example, without fear of losing all that initial leg work.<br /><br /><h1>Resources</h1>A list of links to more kerberos resources can be found here:<br /><a href="http://www.bryansgeekspeak.com/2009/07/teamworks-621-moss-2007-kerberos-sso.html">http://www.bryansgeekspeak.com/2009/07/teamworks-621-moss-2007-kerberos-sso.html</a>