---
title: Lombardi Notes 03dec2008
date: '2008-12-03T07:42:00.001-08:00'
tags:
- Lombardi
modified_time: '2008-12-03T12:51:27.930-08:00'
blogger_id: tag:blogger.com,1999:blog-19111454.post-8189648775568988224
blogger_orig_url: http://www.bryansgeekspeak.com/2008/12/lombardi-notes-03dec2008.html
---

 <br /><br /> <br /> <br /> <br />Notes from dec 3, 2008<br><br><b>continuing from day2</b><br><br><b>Using a rule service within an action to determine value for decision gateway</b><br><br>Since gateways only allow testing of a single condition for a given outbound flow line, we need another way to test multiple conditions before reaching the gateway.&nbsp; We can use an action before the gateway to collect data and run the condition checks we need, then use that same service to set a local boolean (or some other simple value) as the final result of all tested conditions.&nbsp; That boolean is then tested in the gateway to determine if a given outbound line should be followed. Here is how we can set that up in teamworks...<br><br>In the services folder, create a new rule service (right click-&gt;new-&gt;service-&gt;rule service).&nbsp; Drag in a single rule and add flow from start to end.<br><div id="xldu" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_36f6ddm8g4_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_36f6ddm8g4_b"></a><br><br>Perform variable mapping in the rule.&nbsp; Input variables will be passed from the process to the service, then we'll define a single output variable (boolean) to pass back to the process.<br><div id="q4vg" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_37fntfc6hm_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_37fntfc6hm_b"></a><br><br>Then select the "rules" tab.&nbsp; You can add input variables as columns using the + button, you then set conditional rows with values to test against those columns.&nbsp; Note that "Action Requirement" is only a comment, it has no functionality.<br></div><br><div id="ewji" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_38gxq67hgt_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_38gxq67hgt_b"></a><br><br>Save the new service, then we need to apply it to the process BPD.&nbsp; Assign the rule service to the action before the decision dimond thing.&nbsp; Map the boolean variable from the service to the local private variable (you have to define that as a variable in the process too).&nbsp; Now when you run the process, you can see the token pause at the rule service to check the value. You can inspect the variable and continue to debug from there.<br></div><br><div id="kja8" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_39hpn22gds_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_39hpn22gds_b"></a></div><br><b>Morning challenge</b><br>For the weather check and ride home process, we now add in a coach to collect the data to termine what path to take.&nbsp; I chose to collect all the data in one coach at the start using boolean values within my own weather data type.&nbsp; I then test the boolean results in decision gateways throughout the process.&nbsp; <a target="_blank" title="Download a teamworks export of this challenge" href="http://cid-d2c686e4e0564f73.skydrive.live.com/self.aspx/Public/tw%7C_day3%7C_challenge.zip" id="qrev">[Download a teamworks export of this challenge]</a> <br><br><div id="lg.o" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_40czx7k7gc_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_40czx7k7gc_b"></a></div><br><br><div id="m6-k" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_41dqtc297b_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_41dqtc297b_b"></a></div><br><b>Pulling dropdown list values from a database table for access in a coach<br><br>Connectors</b><br>- connectors are methods<br>- can pull from a datasource into java or web services<br><br>1 - Create a database connection in jboss for access from jboss web applications<br>&nbsp;&nbsp;&nbsp; - JNDI datasource<br>2 - Create a database connector (service)<br>&nbsp;&nbsp; &nbsp;- Choose the javaclass that defines the connector (not covered in class how to build that class)<br><br />&nbsp;&nbsp;&nbsp; - use the discover button to read methods and vars used in the class and expose them via the connector<br><br><div id="sz5g" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_43cthw7bd2_b" target="_blank"><img style="width: 320px; height: 257.576px;" src="http://docs.google.com/File?id=dcbd3xmg_43cthw7bd2_b"></a></div><br><br><div id="fbkt" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_44dq62c8gc_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_44dq62c8gc_b"></a></div><br>3 - Create integration definition (service)<br>&nbsp;&nbsp;&nbsp; - reads the connector method and allows access to input/output from that.<br><br><br><div id="b32u" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_45dn8g4ggd_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_45dn8g4ggd_b"></a></div><br><br>you can then test the connection via the "test" link in the integration definition<br><br>4 - create wrapper service that will call the integration definition and allow us to manage all our go via a standard service.<br>&nbsp;&nbsp;&nbsp; - drag integration definition from the folder tree directly into the diagram view of the service. hook up flow connetor lines from start to end.<br>&nbsp;&nbsp;&nbsp; - setup input/output variables to match the integration definition.<br>5 - Go back to the Integration service and do variable mappings by hand.&nbsp; Input variables need to have the default values set to the "hash" value of the param passed in.&nbsp; The notation is something like "&lt;#=tw.local.myvar#&gt;".&nbsp; The output var is mapped by its standard name without the hash goo.<br>6 - create yet another service that will now get our data for the department dropdown list<br>&nbsp;&nbsp;&nbsp; - drag in the sql execute service<br>&nbsp;&nbsp;&nbsp; - map variables to the sql execute service.&nbsp; use the automapping and allow it to create private vars.<br>&nbsp;&nbsp;&nbsp; - drag in a server scriptlet item (or server script item.&nbsp; If you use a scriptlet, be sure to bind it to a variable!) to build a sql string you can pass in to the sql execute. implementation = " <i>SELECT departmentName, departmentCode FROM departments</i> "<br>&nbsp;&nbsp;&nbsp; - drag in a server script item to build the dsn.&nbsp; implementation = " <i>tw.local.dsn = "jdbc/TrainingDB";</i> "<br>&nbsp;&nbsp;&nbsp; - Now debug the service and see if it works<br><br><div id="zkir" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_46cmszvpdw_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_46cmszvpdw_b"></a></div><br><br><div id="yb9_" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_479zbd32d7_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_479zbd32d7_b"></a></div><br>Note that using this method still simply ends up creating a string SQL statement that gets passed to the server.&nbsp; This example does not cover bindparams to the database at all.&nbsp; I think bindparams are supported in JDBC, so you should be able to build in support via the classes using the method here.<br><br>7 - now add another server script block in order to map the xml results to a javascript list array of key value pairs.<br><br><div id="qa-o" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_48c9md8xgg_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_48c9md8xgg_b"></a></div><br>8 - Update the coach service to use the get department list<br>&nbsp;&nbsp;&nbsp; -now go back to the coach service and drag in the "get department list" service.&nbsp; Connect it to the flow before the coach runs, then setup variable mapping so that the department list variable is passed into the coach service as shown below (using automapping)<br><br><br><div id="n5.j" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_50crpc5zc5_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_50crpc5zc5_b"></a></div><br>&nbsp;&nbsp;&nbsp; - now go and update the coach form to use the new list.&nbsp; Modify the department list field, delete any manual values set, then enable dynamic data via a list variable.&nbsp; Select the department list variable you just defined. The image below gives you an idea of whats expected for the bindings.<br><div id="sys6" style="padding: 1em 0pt; text-align: left;"><a href="http://docs.google.com/File?id=dcbd3xmg_49gx6n6wcw_b" target="_blank"><img style="width: 320px; height: 248.234px;" src="http://docs.google.com/File?id=dcbd3xmg_49gx6n6wcw_b"></a></div>&nbsp;&nbsp;&nbsp; - run the coach form to launch it in a browser and test that the values do show up properly.<br></div><br>