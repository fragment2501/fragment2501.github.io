---
title: 'MOSS 2007 - CQWP: Group Header Count'
date: '2009-05-07T14:22:00.000-07:00'
author: Bryan
tags:
- MOSS
- SharePoint
modified_time: '2009-05-07T14:51:41.397-07:00'
thumbnail: http://1.bp.blogspot.com/_It8-g3_9vec/SgNUxcdeHWI/AAAAAAAAArA/tIcplPEvSt8/s72-c/contentquerymain1.JPG
blogger_id: tag:blogger.com,1999:blog-19111454.post-3332248996222870520
blogger_orig_url: http://www.bryansgeekspeak.com/2009/05/moss-2007-cqwp-row-count-and-group.html
---

In a recent change request, I was asked to change a CQWP to output a hypterlink to "top of page" to the right of the group heading if it was any heading other than the first.  Considering a list of items grouped by year, the output should look something like this:<br /><br /><div class="code">2009<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 1<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 2<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 3<br />2008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(top of page)<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 1<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 2<br />2007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(top of page)<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 1<br />&nbsp;&nbsp;&nbsp;&nbsp;Item 2<br />...<br /></div><br /><br />If you've used the CQWP at all, you'll know all the output formatting templates are xml files stored in the directory "/Style Library/XSL Style Sheets/" which you can access via SPD.<br /><br />The various style formats for group headings are stored in header.xsl, but all the "looping" is done a level higher in ContentQueryMain.xsl.  You'll need to edit both files to make this change.  In my example, luckily, I didnt need to keep count of every unique group name.  I only needed to know if I was on the first group heading.  <br /><br />So, the first thing I do is edit ContentQueryMain.xsl to pass along a variable to tell header.xsl if we are on the first group.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_It8-g3_9vec/SgNUxcdeHWI/AAAAAAAAArA/tIcplPEvSt8/s1600-h/contentquerymain1.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 245px;" src="http://1.bp.blogspot.com/_It8-g3_9vec/SgNUxcdeHWI/AAAAAAAAArA/tIcplPEvSt8/s320/contentquerymain1.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5333199592166923618" /></a><br /><br />You can see in the screenshot, all I'm doing is adding a new hard coded parameter to the CallHeaderTemplate call where MS already has code to do special output if the current row is the first group header row.  Piggybacking off of that code, I can pass this parameter down to the header.xsl template as shown below.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_It8-g3_9vec/SgNVa0cuzMI/AAAAAAAAArI/JMnW8BZrQBc/s1600-h/contentquerymain2.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 34px;" src="http://3.bp.blogspot.com/_It8-g3_9vec/SgNVa0cuzMI/AAAAAAAAArI/JMnW8BZrQBc/s320/contentquerymain2.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5333200302980910274" /></a><br /><br />That gets the variable to the header.xsl template. Now we need to edit that file and catch the passed parameter, then use that value to test and see if we are outputting the first group header, and if so, we dont display the new hyperlink.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_It8-g3_9vec/SgNV_E-4wqI/AAAAAAAAArQ/SZC0H1e0pQI/s1600-h/header1.JPG"><img style="cursor:pointer; cursor:hand;width: 320px; height: 123px;" src="http://2.bp.blogspot.com/_It8-g3_9vec/SgNV_E-4wqI/AAAAAAAAArQ/SZC0H1e0pQI/s320/header1.JPG" border="0" alt=""id="BLOGGER_PHOTO_ID_5333200925894427298" /></a><br /><br />The only two parts you need from the above screenshot is this variable param<br /><br /><div class="code">&lt;xsl:param name="GroupPos"&gt; <br /></div><br />and also the test for anything but a value of 1<br /><br /><div class="code">&lt;xsl:if test=&quot;$GroupPos != 1&quot; &gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;div style=&quot;float:right;&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a href=&quot;#top&quot;&gt;top of page&lt;/a&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br />&lt;/xsl:if&gt;<br /></div><br /><br />All done! now just edit a CQWP instance to use the new group heading style and tweak to your liking.<br /><br />The next step would be to track the group headings with a counter, possibly to alter the template for every other header row...