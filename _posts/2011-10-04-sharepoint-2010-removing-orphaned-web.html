---
title: SharePoint 2010 - Removing Orphaned WebParts
date: '2011-10-04T17:25:00.000-07:00'
tags:
- SharePoint 2010
modified_time: '2011-10-04T17:27:57.625-07:00'
thumbnail: http://4.bp.blogspot.com/-WGxMlfaQ5TY/TouX5_L_lHI/AAAAAAAAABA/1VtEHV6b-aQ/s72-c/SharePoint2010MissingServerDependencies.PNG
blogger_id: tag:blogger.com,1999:blog-19111454.post-1936492023241429255
blogger_orig_url: http://www.bryansgeekspeak.com/2011/10/sharepoint-2010-removing-orphaned-web.html
---

While troubleshooting a completely different issue in one of our SharePoint 2010 test farms, I noticed an error reported in the "Health Report" in the central admin. The error "Missing server side dependencies" came up with an explanation saying "WebPart class [GUID] is referenced [x] times in the database [ContentDB], but is not installed on the current farm."<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-WGxMlfaQ5TY/TouX5_L_lHI/AAAAAAAAABA/1VtEHV6b-aQ/s1600/SharePoint2010MissingServerDependencies.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="182" src="http://4.bp.blogspot.com/-WGxMlfaQ5TY/TouX5_L_lHI/AAAAAAAAABA/1VtEHV6b-aQ/s320/SharePoint2010MissingServerDependencies.PNG" width="320" /></a></div><br />In my case this was a web part we used back before the site had been upgraded to sharepoint 2010. Amazingly, the web part was still working even though SharePoint 2010 was flagging it as an orphan. In this case that's fine, I wanted to remove the web part from all pages anyway.<br /><br />...so how in gods name do I find what pages the WebPart is on? <br /><br />Thanks to Phil's blog post <a href="http://get-spscripts.com/2011/08/diagnose-missingwebpart-and.html">"Diagnose MissingWebPart and MissingAssembly issues from the SharePoint Health Analyzer using PowerShell"</a> I was able to figure this out. Here is my rehash of Phil's info, connecting to SQL server directly rather than using powershell.<br /><br /><b>Query Against the WebPart GUID</b><br />Snag the WebPart GUID from the error message, then use SQL server management studio to connect to your SharePoint 2010 content database.&nbsp; Run the following query, replacing the GUID with your WebPart GUID.<br /><br /><div class="code"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10pt;">SELECT</span><span style="font-family: &quot;Courier New&quot;; font-size: 10pt;"> Id<span style="color: grey;">,</span> SiteId<span style="color: grey;">,</span> DirName<span style="color: grey;">,</span> LeafName<span style="color: grey;">,</span> WebId<span style="color: grey;">,</span> ListId<span style="color: grey;">,</span> tp_ZoneID<span style="color: grey;">,</span> tp_DisplayName </span><br /><div class="MsoNormal" style="text-autospace: none;"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10pt;">from</span><span style="font-family: &quot;Courier New&quot;; font-size: 10pt;"> AllDocs </span></div><div class="MsoNormal" style="text-autospace: none;"><span style="font-family: &quot;Courier New&quot;; font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: grey;">inner</span> <span style="color: grey;">join</span>AllWebParts <span style="color: blue;">on</span> AllDocs<span style="color: grey;">.</span>Id <span style="color: grey;">=</span> AllWebParts<span style="color: grey;">.</span>tp_PageUrlID </span></div><div class="MsoNormal"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10pt;">where</span><span style="font-family: &quot;Courier New&quot;; font-size: 10pt;">AllWebParts<span style="color: grey;">.</span>tp_WebPartTypeID <span style="color: grey;">=</span> <span style="color: red;">'8a860dca-4061-d270-a67b-f6bde7fc3e0a'</span><span style="color: grey;">;</span></span></div></div><br /><br />The DirName gives you the path to the page you want ("/MySubSite/Pages") and the LeafName gives you the name of the page ("default.aspx").<b>&nbsp;</b><br /><br /><b>Map The SiteId GUID To URL</b> <br />If you have more than one site collection in your farm, the SiteID tells you what collection you are dealing with. You'll want to map the SiteID to a website URL, so bust out the sharepoint powershell prompt on your central admin server and run the following command:<br /><br /><div class="code">PS c:\&gt; Get-SPSite</div><br />it should output a list that looks something like this:<br /><br /><div class="code">Url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID<br /><br />---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --<br />http://MySite1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 707f838a-56ab-475b-9a52-fdf05a8f3e7a<br />http://MySite2 &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11c04ca8-ad58-4147-8344-8132e5788090</div><br /><br />The ID in the above table maps back to the SiteId from the SQL query - and there you have your URL to SiteId mapping! Hooray!<br /><br />Now you can put it all together to get the full URL of the pages you need to fix.<br /><br /><b>Removing Bad WebParts</b><br />Sadly, this can be tricky part. When you start deleting the bad WebPart, keep these things in mind:<br /><br /><ul><li>DELETE the web part from the page. Do not use the "Remove" option, which only hides the web part instance rather than delete it.</li><li>You can quickly view all WebParts assigned to a page and delete them by appending "contents=1" to the url. Ex: "http://mysite/Pages/default.aspx?contents=1" (Another great tip from Phil, thanks!)</li></ul><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-a4Yk6dE2VTo/TouhbY6m9CI/AAAAAAAAABE/cQ9iRHvoAYE/s1600/ContentsEqualsOneView.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="91" src="http://3.bp.blogspot.com/-a4Yk6dE2VTo/TouhbY6m9CI/AAAAAAAAABE/cQ9iRHvoAYE/s320/ContentsEqualsOneView.PNG" width="320" /></a></div><ul><li>If you have the publishing feature enabled, you could have instances of the web part linked to old versions of your page.&nbsp; Be sure to delete the version history of the page if necessary ... and if you do that, you will need to also empty the SharePoint recycle bin ... and -then- empty the "Second Stage" SharePoint recycle bin if you have it enabled in the central admin, which only the Farm Admin can do from the site collection root settings page.&nbsp; To get to the Second Stage recycle bin, you can login to the front end site as a farm admin account and hit the url "/_layouts/AdminRecycleBin.aspx". Then pick the option "Deleted from end user Recycle Bin".</li></ul><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-OogJv5g-nrc/TouiWohsIpI/AAAAAAAAABI/vre56Deuogc/s1600/SecondStageRecycleBin.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="42" src="http://4.bp.blogspot.com/-OogJv5g-nrc/TouiWohsIpI/AAAAAAAAABI/vre56Deuogc/s320/SecondStageRecycleBin.PNG" width="320" /></a></div><br /><br /><b>Verify All Instances Are Gone</b><br />Once you've deleted the web part from all pages, do a sanity check - run the SQL query again to confirm no records are returned.&nbsp; You can also run the "Health Check" again by hand to confirm SharePoint agrees that the web part is gone.&nbsp; Fire up the SharePoint PowerShell command prompt and run the command "Test-SPContentDatabase" shown below, but of course swap out the content database and web application names for your own.<br /><br /><div class="code">PS c:\&gt; Test-SPContentDatabase -name MYSP2010-Content -WebApplication http://MyApp<br /><br /></div><br />